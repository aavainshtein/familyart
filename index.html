<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ê—É–∫—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏ —Ö—É–¥–æ–∂–Ω–∏–∫–æ–≤</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        min-height: 100vh;
        color: #e4e4e4;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        backdrop-filter: blur(10px);
      }

      h1 {
        font-size: 2.2em;
        margin-bottom: 10px;
        color: #ffd700;
      }

      .subtitle {
        color: #888;
        font-size: 0.9em;
      }

      .artist-selector {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 30px;
        padding: 20px;
        background: rgba(76, 175, 80, 0.1);
        border-radius: 15px;
        border: 1px solid rgba(76, 175, 80, 0.2);
        align-items: flex-end;
      }

      .artist-selector .control-group {
        flex: 1;
        min-width: 250px;
      }

      .artist-selector .control-group:last-child {
        flex: 0 0 auto;
        min-width: 180px;
      }

      .file-input-wrapper {
        position: relative;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .file-input-wrapper select {
        flex: 1;
        min-width: 200px;
      }

      .file-input-wrapper input[type="file"] {
        display: none;
      }

      .file-input-label {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        border: 1px dashed rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.05);
        color: #aaa;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        white-space: nowrap;
      }

      .file-input-label:hover {
        border-color: #ffd700;
        color: #ffd700;
        background: rgba(255, 215, 0, 0.1);
      }

      .controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
      }

      .input-pair {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .input-pair input {
        flex: 1;
        min-width: 100px;
      }

      .control-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
        position: relative;
      }

      .control-group select,
      .control-group button {
        width: 100%;
      }

      .control-group label {
        font-weight: 600;
        color: #aaa;
        font-size: 0.85em;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      input,
      select,
      button {
        padding: 12px 16px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.08);
        color: #fff;
        font-size: 14px;
        transition: all 0.3s ease;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #ffd700;
        box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
      }

      select {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23fff' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        padding-right: 36px;
        cursor: pointer;
      }

      select option {
        background: #1a1a2e;
        color: #fff;
      }

      button {
        cursor: pointer;
        background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
        color: #1a1a2e;
        font-weight: 600;
        border: none;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
      }

      button.secondary {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      button.secondary:hover {
        background: rgba(255, 255, 255, 0.15);
        box-shadow: none;
      }

      .currency-panel {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 30px;
        padding: 20px;
        background: rgba(255, 215, 0, 0.1);
        border-radius: 15px;
        border: 1px solid rgba(255, 215, 0, 0.2);
        align-items: flex-end;
      }

      .currency-panel .control-group {
        flex: 1;
        min-width: 250px;
      }

      .currency-panel .control-group:first-child {
        flex: 2;
        min-width: 350px;
      }

      .currency-panel .control-group:last-child {
        flex: 0 0 auto;
        min-width: 150px;
      }

      .rate-inputs {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .rate-input-group {
        display: flex;
        flex-direction: column;
        gap: 4px;
        flex: 1;
        min-width: 70px;
      }

      .rate-label {
        font-size: 0.75em;
        color: #ffd700;
        font-weight: 600;
        text-align: center;
      }

      .rate-input-group input {
        width: 100%;
        text-align: center;
      }

      /* Info button styles */
      .info-btn {
        background: rgba(255, 215, 0, 0.2);
        border: 1px solid #ffd700;
        color: #ffd700;
        width: 22px !important;
        height: 22px !important;
        min-width: 22px;
        max-width: 22px;
        min-height: 22px;
        max-height: 22px;
        flex: 0 0 22px;
        border-radius: 50%;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-left: 8px;
        transition: all 0.2s;
        padding: 0;
        line-height: 1;
        vertical-align: middle;
      }

      .info-btn:hover {
        background: #ffd700;
        color: #1a1a2e;
      }

      .label-with-info {
        display: inline-flex;
        align-items: center;
        width: auto;
      }

      /* Rates table styles */
      .rates-table-container {
        max-height: 400px;
        overflow-y: auto;
        margin-top: 15px;
      }

      .rates-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9em;
      }

      .rates-table th,
      .rates-table td {
        padding: 8px 12px;
        text-align: right;
        border-bottom: 1px solid rgba(255, 215, 0, 0.2);
      }

      .rates-table th {
        background: rgba(255, 215, 0, 0.15);
        color: #ffd700;
        position: sticky;
        top: 0;
        text-align: center;
      }

      .rates-table th:first-child,
      .rates-table td:first-child {
        text-align: left;
        font-weight: 600;
        color: #ffd700;
      }

      .rates-table tr:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      .rates-source {
        margin-top: 15px;
        font-size: 0.85em;
        color: #888;
        font-style: italic;
      }

      /* Info modal styles */
      .info-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 2000;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .info-modal.active {
        display: flex;
      }

      .info-modal-content {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        border: 1px solid rgba(255, 215, 0, 0.3);
        border-radius: 15px;
        padding: 30px;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
      }

      .info-modal-content h3 {
        color: #ffd700;
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 1.4em;
      }

      .info-modal-content p {
        color: #e0e0e0;
        line-height: 1.6;
        margin-bottom: 15px;
      }

      .info-modal-content ul {
        color: #e0e0e0;
        padding-left: 20px;
        margin-bottom: 15px;
      }

      .info-modal-content li {
        margin-bottom: 8px;
        line-height: 1.5;
      }

      .info-modal-content strong {
        color: #ffd700;
      }

      .info-modal-close {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        color: #888;
        font-size: 28px;
        cursor: pointer;
        transition: color 0.2s;
      }

      .info-modal-close:hover {
        color: #ffd700;
      }

      .stats {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 30px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
      }

      .stat-item {
        text-align: center;
        padding: 10px 20px;
      }

      .stat-value {
        font-size: 1.8em;
        font-weight: bold;
        color: #ffd700;
      }

      .stat-label {
        font-size: 0.85em;
        color: #888;
      }

      .artworks-grid {
        display: grid;
        gap: 20px;
      }

      .artwork-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 25px;
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        gap: 20px;
      }

      .artwork-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        border-color: rgba(255, 215, 0, 0.3);
      }

      .artwork-image-container {
        flex: 0 0 150px;
        display: flex;
        align-items: flex-start;
      }

      .artwork-image {
        width: 150px;
        height: 150px;
        object-fit: cover;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid rgba(255, 255, 255, 0.1);
      }

      .artwork-image:hover {
        border-color: #ffd700;
        transform: scale(1.05);
      }

      .artwork-image-placeholder {
        width: 150px;
        height: 150px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #555;
        font-size: 3em;
      }

      .artwork-content {
        flex: 1;
        min-width: 0;
      }

      .artwork-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
        gap: 15px;
      }

      .artwork-title {
        font-size: 1.3em;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      .artwork-year {
        background: rgba(255, 215, 0, 0.2);
        color: #ffd700;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.85em;
        white-space: nowrap;
      }

      .artwork-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .detail-item {
        background: rgba(0, 0, 0, 0.2);
        padding: 12px;
        border-radius: 8px;
      }

      .detail-label {
        font-size: 0.75em;
        color: #888;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 5px;
      }

      .detail-value {
        font-size: 1em;
        color: #fff;
      }

      .price-display {
        background: linear-gradient(
          135deg,
          rgba(255, 215, 0, 0.15) 0%,
          rgba(255, 170, 0, 0.1) 100%
        );
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 15px;
      }

      .price-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        flex-wrap: wrap;
        gap: 10px;
      }

      .price-row:last-child {
        border-bottom: none;
      }

      .price-label {
        color: #aaa;
        font-size: 0.9em;
      }

      .price-value {
        font-weight: 600;
        color: #fff;
      }

      .price-rub {
        color: #4caf50;
        font-size: 0.85em;
      }

      .price-rub-historical {
        color: #ff9800;
        font-size: 0.85em;
      }

      .sales-history {
        margin-top: 15px;
      }

      .history-toggle {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        width: 100%;
        text-align: left;
        color: #fff;
        padding: 10px 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .history-toggle:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: none;
        box-shadow: none;
      }

      .history-content {
        display: none;
        margin-top: 10px;
        padding: 15px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
      }

      .history-content.show {
        display: block;
      }

      .history-item {
        padding: 12px;
        margin-bottom: 10px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        border-left: 3px solid #ffd700;
      }

      .history-item:last-child {
        margin-bottom: 0;
      }

      .history-date {
        font-weight: 600;
        color: #ffd700;
        margin-bottom: 5px;
      }

      .history-auction {
        font-size: 0.9em;
        color: #aaa;
        margin-bottom: 8px;
      }

      .history-prices {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        font-size: 0.9em;
      }

      .sold {
        color: #4caf50;
      }

      .not-sold {
        color: #f44336;
      }

      .no-data {
        color: #888;
        font-style: italic;
      }

      .loading {
        text-align: center;
        padding: 50px;
        color: #888;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 3px solid rgba(255, 215, 0, 0.1);
        border-top-color: #ffd700;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .empty-state {
        text-align: center;
        padding: 50px;
        color: #888;
      }

      .welcome-state {
        text-align: center;
        padding: 80px 20px;
        color: #888;
      }

      .welcome-state h2 {
        color: #ffd700;
        margin-bottom: 20px;
        font-size: 1.5em;
      }

      .welcome-state p {
        margin-bottom: 10px;
        line-height: 1.6;
      }

      .dimensions-badge {
        display: inline-block;
        background: rgba(100, 149, 237, 0.2);
        color: #6495ed;
        padding: 4px 10px;
        border-radius: 15px;
        font-size: 0.85em;
        margin-right: 5px;
      }

      .area-badge {
        display: inline-block;
        background: rgba(147, 112, 219, 0.2);
        color: #9370db;
        padding: 4px 10px;
        border-radius: 15px;
        font-size: 0.85em;
      }

      footer {
        text-align: center;
        margin-top: 40px;
        padding: 20px;
        color: #666;
        font-size: 0.85em;
      }

      .hidden {
        display: none !important;
      }

      /* Lightbox —Å—Ç–∏–ª–∏ */
      .lightbox {
        display: none;
        position: fixed;
        z-index: 9999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.95);
        backdrop-filter: blur(10px);
      }

      .lightbox.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .lightbox-content {
        max-width: 90%;
        max-height: 90%;
        position: relative;
      }

      .lightbox-image {
        max-width: 100%;
        max-height: 85vh;
        border-radius: 10px;
        box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
      }

      .lightbox-caption {
        text-align: center;
        color: #fff;
        padding: 15px;
        font-size: 1.1em;
      }

      .lightbox-close {
        position: absolute;
        top: 20px;
        right: 30px;
        color: #fff;
        font-size: 40px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.3s;
        z-index: 10000;
      }

      .lightbox-close:hover {
        color: #ffd700;
      }

      .lightbox-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        color: #fff;
        font-size: 50px;
        font-weight: bold;
        cursor: pointer;
        padding: 20px;
        transition: color 0.3s;
        user-select: none;
      }

      .lightbox-nav:hover {
        color: #ffd700;
      }

      .lightbox-prev {
        left: 20px;
      }

      .lightbox-next {
        right: 20px;
      }

      @media (max-width: 768px) {
        .artwork-card {
          flex-direction: column;
        }

        .artwork-image-container {
          flex: none;
          width: 100%;
          justify-content: center;
        }

        .artwork-image,
        .artwork-image-placeholder {
          width: 200px;
          height: 200px;
        }

        .controls {
          grid-template-columns: 1fr;
        }

        .artwork-header {
          flex-direction: column;
        }

        .stats {
          flex-direction: column;
        }

        .currency-panel {
          flex-direction: column;
        }

        .currency-panel .control-group,
        .currency-panel .control-group:first-child,
        .currency-panel .control-group:last-child {
          flex: 1 1 100%;
          min-width: 100%;
        }

        .rate-inputs {
          flex-wrap: wrap;
        }

        .rate-inputs input {
          flex: 1 1 45%;
          min-width: 80px;
        }

        .artist-selector {
          flex-direction: column;
        }

        .artist-selector .control-group {
          min-width: 100%;
        }

        .lightbox-nav {
          font-size: 30px;
          padding: 10px;
        }

        .lightbox-prev {
          left: 5px;
        }

        .lightbox-next {
          right: 5px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1 id="artistName">–ê—É–∫—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏ —Ö—É–¥–æ–∂–Ω–∏–∫–æ–≤</h1>
        <p class="subtitle" id="dataSource">
          –í—ã–±–µ—Ä–∏—Ç–µ —Ö—É–¥–æ–∂–Ω–∏–∫–∞ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ JSON —Ñ–∞–π–ª
        </p>
      </header>

      <div class="artist-selector">
        <div class="control-group">
          <label>–í—ã–±–æ—Ä —Ö—É–¥–æ–∂–Ω–∏–∫–∞</label>
          <div class="file-input-wrapper">
            <select id="artistSelect">
              <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ö—É–¥–æ–∂–Ω–∏–∫–∞ --</option>
              <option value="bronnikov.json">–ë—Ä–æ–Ω–Ω–∏–∫–æ–≤ –§—ë–¥–æ—Ä –ê–Ω–¥—Ä–µ–µ–≤–∏—á</option>
              <option value="byukhtger.json">–ë—é—Ö—Ç–≥–µ—Ä –†–æ–±–µ—Ä—Ç –ì–µ—Ä–º–∞–Ω–æ–≤–∏—á</option>
              <option value="vasilkovskiy.json">
                –í–∞—Å–∏–ª—å–∫–æ–≤—Å–∫–∏–π –°–µ—Ä–≥–µ–π –ò–≤–∞–Ω–æ–≤–∏—á
              </option>
              <option value="pereplyotchikov.json">
                –ü–µ—Ä–µ–ø–ª—ë—Ç—á–∏–∫–æ–≤ –í–∞—Å–∏–ª–∏–π –í–∞—Å–∏–ª—å–µ–≤–∏—á
              </option>
              <option value="saltanov.json">–°–∞–ª—Ç–∞–Ω–æ–≤ –°–µ—Ä–≥–µ–π –ù–∏–∫–æ–ª–∞–µ–≤–∏—á</option>
              <option value="sibirskiy.json">
                –°–∏–±–∏—Ä—Å–∫–∏–π –í–µ–Ω–∏–∞–º–∏–Ω –ú–∏—Ö–∞–π–ª–æ–≤–∏—á
              </option>
              <option value="solomatkin.json">
                –°–æ–ª–æ–º–∞—Ç–∫–∏–Ω –õ–µ–æ–Ω–∏–¥ –ò–≤–∞–Ω–æ–≤–∏—á
              </option>
              <option value="fyodorov.json">–§—ë–¥–æ—Ä–æ–≤ –°–µ–º—ë–Ω –§—ë–¥–æ—Ä–æ–≤–∏—á</option>
            </select>
            <label class="file-input-label" for="fileInput">
              üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å JSON
            </label>
            <input type="file" id="fileInput" accept=".json" />
          </div>
        </div>
        <div class="control-group">
          <label>&nbsp;</label>
          <button onclick="loadSelectedArtist()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        </div>
      </div>

      <div id="mainContent" class="hidden">
        <div class="currency-panel">
          <div class="control-group" id="currencyRatesGroup">
            <label class="label-with-info">
              –ê–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å ‚ÇΩ
              <button
                class="info-btn"
                onclick="showCurrencyInfo()"
                title="–°–ø—Ä–∞–≤–∫–∞"
              >
                ?
              </button>
            </label>
            <div class="rate-inputs" id="rateInputsContainer">
              <!-- –ü–æ–ª—è –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
          </div>
          <div class="control-group">
            <label>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ü–µ–Ω—ã –≤ —Ä—É–±–ª—è—Ö</label>
            <select id="priceMode">
              <option value="both">
                –ê–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å + –∫—É—Ä—Å –Ω–∞ –¥–∞—Ç—É –∞—É–∫—Ü–∏–æ–Ω–∞
              </option>
              <option value="current">–¢–æ–ª—å–∫–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å</option>
              <option value="historical">–¢–æ–ª—å–∫–æ –∫—É—Ä—Å –Ω–∞ –¥–∞—Ç—É –∞—É–∫—Ü–∏–æ–Ω–∞</option>
              <option value="original">–¢–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞</option>
            </select>
          </div>
          <div class="control-group">
            <label>&nbsp;</label>
            <button onclick="updateRates()">–û–±–Ω–æ–≤–∏—Ç—å –∫—É—Ä—Å—ã</button>
          </div>
          <div class="control-group">
            <label>&nbsp;</label>
            <button
              onclick="showHistoricalRates()"
              style="
                background: transparent;
                border: 1px solid #ffd700;
                color: #ffd700;
              "
            >
              üìÖ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∫—É—Ä—Å—ã
            </button>
          </div>
        </div>

        <div class="controls">
          <div class="control-group">
            <label>–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é</label>
            <input
              type="text"
              id="searchTitle"
              placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ..."
            />
          </div>
          <div class="control-group">
            <label>–§–∏–ª—å—Ç—Ä –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º</label>
            <div class="input-pair">
              <input type="number" id="minWidth" placeholder="–ú–∏–Ω. —à–∏—Ä–∏–Ω–∞" />
              <input type="number" id="maxWidth" placeholder="–ú–∞–∫—Å. —à–∏—Ä–∏–Ω–∞" />
            </div>
          </div>
          <div class="control-group">
            <label>&nbsp;</label>
            <div class="input-pair">
              <input type="number" id="minHeight" placeholder="–ú–∏–Ω. –≤—ã—Å–æ—Ç–∞" />
              <input type="number" id="maxHeight" placeholder="–ú–∞–∫—Å. –≤—ã—Å–æ—Ç–∞" />
            </div>
          </div>
          <div class="control-group">
            <label>–§–∏–ª—å—Ç—Ä –ø–æ –ø–ª–æ—â–∞–¥–∏ (—Å–º¬≤)</label>
            <div class="input-pair">
              <input type="number" id="minArea" placeholder="–ú–∏–Ω. –ø–ª–æ—â–∞–¥—å" />
              <input type="number" id="maxArea" placeholder="–ú–∞–∫—Å. –ø–ª–æ—â–∞–¥—å" />
            </div>
          </div>
          <div class="control-group">
            <label>–î–∞—Ç–∞ –∞—É–∫—Ü–∏–æ–Ω–∞</label>
            <div class="input-pair">
              <input type="date" id="dateFrom" />
              <input type="date" id="dateTo" />
            </div>
          </div>
          <div class="control-group">
            <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
            <select id="sortBy">
              <option value="date-desc">–ü–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ)</option>
              <option value="date-asc">–ü–æ –¥–∞—Ç–µ (—Å—Ç–∞—Ä—ã–µ)</option>
              <option value="width-asc">–ü–æ —à–∏—Ä–∏–Ω–µ ‚Üë</option>
              <option value="width-desc">–ü–æ —à–∏—Ä–∏–Ω–µ ‚Üì</option>
              <option value="height-asc">–ü–æ –≤—ã—Å–æ—Ç–µ ‚Üë</option>
              <option value="height-desc">–ü–æ –≤—ã—Å–æ—Ç–µ ‚Üì</option>
              <option value="area-asc">–ü–æ –ø–ª–æ—â–∞–¥–∏ ‚Üë</option>
              <option value="area-desc">–ü–æ –ø–ª–æ—â–∞–¥–∏ ‚Üì</option>
              <option value="title-asc">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ê-–Ø</option>
              <option value="title-desc">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é –Ø-–ê</option>
            </select>
          </div>
          <div class="control-group">
            <label>–°—Ç–∞—Ç—É—Å –ø—Ä–æ–¥–∞–∂–∏</label>
            <select id="saleStatus">
              <option value="all">–í—Å–µ</option>
              <option value="sold">–¢–æ–ª—å–∫–æ –ø—Ä–æ–¥–∞–Ω–Ω—ã–µ</option>
              <option value="not-sold">–¢–æ–ª—å–∫–æ –Ω–µ –ø—Ä–æ–¥–∞–Ω–Ω—ã–µ</option>
            </select>
          </div>
          <div class="control-group">
            <label>&nbsp;</label>
            <button onclick="resetFilters()">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
          </div>
        </div>

        <div class="stats">
          <div class="stat-item">
            <div class="stat-value" id="totalWorks">0</div>
            <div class="stat-label">–í—Å–µ–≥–æ —Ä–∞–±–æ—Ç</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="filteredWorks">0</div>
            <div class="stat-label">–ü–æ–∫–∞–∑–∞–Ω–æ</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="soldWorks">0</div>
            <div class="stat-label">–ü—Ä–æ–¥–∞–Ω–æ</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="notSoldWorks">0</div>
            <div class="stat-label">–ù–µ –ø—Ä–æ–¥–∞–Ω–æ</div>
          </div>
        </div>
      </div>

      <div class="artworks-grid" id="artworksGrid">
        <div class="welcome-state">
          <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
          <p>
            –í—ã–±–µ—Ä–∏—Ç–µ —Ö—É–¥–æ–∂–Ω–∏–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π JSON —Ñ–∞–π–ª.
          </p>
          <p>–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—ã,</p>
          <p>
            –∞ —Ç–∞–∫–∂–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ü–µ–Ω—ã –≤ —Ä—É–±–ª—è—Ö –ø–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º—É –∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–º—É
            –∫—É—Ä—Å—É.
          </p>
        </div>
      </div>

      <footer>
        <p>–î–∞–Ω–Ω—ã–µ: ARTinvestment.RU | –°–æ–∑–¥–∞–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∞—É–∫—Ü–∏–æ–Ω–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂</p>
      </footer>
    </div>

    <!-- Lightbox -->
    <div id="lightbox" class="lightbox">
      <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
      <span class="lightbox-nav lightbox-prev" onclick="navigateLightbox(-1)"
        >&#10094;</span
      >
      <div class="lightbox-content">
        <img id="lightbox-image" class="lightbox-image" src="" alt="" />
        <div id="lightbox-caption" class="lightbox-caption"></div>
      </div>
      <span class="lightbox-nav lightbox-next" onclick="navigateLightbox(1)"
        >&#10095;</span
      >
    </div>

    <!-- Currency Info Modal -->
    <div
      id="currencyInfoModal"
      class="info-modal"
      onclick="closeCurrencyInfo(event)"
    >
      <div class="info-modal-content" onclick="event.stopPropagation()">
        <button class="info-modal-close" onclick="closeCurrencyInfo()">
          &times;
        </button>
        <h3>üí± –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç</h3>
        <p>–≠—Ç–∞ —Å–µ–∫—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—ã –∞—É–∫—Ü–∏–æ–Ω–æ–≤ –≤ —Ä—É–±–ª–∏.</p>

        <p>
          <strong>–ê–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å</strong> ‚Äî —Ç–µ–∫—É—â–∏–µ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç –∫ —Ä—É–±–ª—é. –í—ã
          –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∏—Ö –≤—Ä—É—á–Ω—É—é –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞.
        </p>

        <p>
          <strong>–ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ –≤–∞–ª—é—Ç—ã</strong>, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤
          —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Ö—É–¥–æ–∂–Ω–∏–∫–∞.
        </p>

        <p><strong>–†–µ–∂–∏–º—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ü–µ–Ω:</strong></p>
        <ul>
          <li>
            <strong>–ê–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å + –∫—É—Ä—Å –Ω–∞ –¥–∞—Ç—É –∞—É–∫—Ü–∏–æ–Ω–∞</strong> ‚Äî
            –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
          </li>
          <li>
            <strong>–¢–æ–ª—å–∫–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å</strong> ‚Äî –ø–µ—Ä–µ—Å—á—ë—Ç –ø–æ —Ç–µ–∫—É—â–µ–º—É –∫—É—Ä—Å—É
            (–¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å–µ–≥–æ–¥–Ω—è)
          </li>
          <li>
            <strong>–¢–æ–ª—å–∫–æ –∫—É—Ä—Å –Ω–∞ –¥–∞—Ç—É –∞—É–∫—Ü–∏–æ–Ω–∞</strong> ‚Äî –ø–µ—Ä–µ—Å—á—ë—Ç –ø–æ
            –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–º—É –∫—É—Ä—Å—É –¶–ë –†–§ –Ω–∞ –¥–∞—Ç—É –ø—Ä–æ–¥–∞–∂–∏
          </li>
          <li>
            <strong>–¢–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞</strong> ‚Äî –±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏,
            –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—É—é –≤–∞–ª—é—Ç—É –∞—É–∫—Ü–∏–æ–Ω–∞
          </li>
        </ul>

        <p>
          <strong>–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∫—É—Ä—Å—ã</strong> (2007‚Äì2025) –±–µ—Ä—É—Ç—Å—è –∏–∑
          —Å—Ä–µ–¥–Ω–µ–≥–æ–¥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¶–ë –†–§.
        </p>

        <p>
          –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤ –Ω–∞–∂–º–∏—Ç–µ <strong>¬´–û–±–Ω–æ–≤–∏—Ç—å –∫—É—Ä—Å—ã¬ª</strong> –¥–ª—è
          –ø–µ—Ä–µ—Å—á—ë—Ç–∞.
        </p>
      </div>
    </div>

    <!-- Historical Rates Modal -->
    <div
      id="historicalRatesModal"
      class="info-modal"
      onclick="closeHistoricalRates(event)"
    >
      <div
        class="info-modal-content"
        onclick="event.stopPropagation()"
        style="max-width: 800px"
      >
        <button class="info-modal-close" onclick="closeHistoricalRates()">
          &times;
        </button>
        <h3>üìÖ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∫—É—Ä—Å—ã –¶–ë –†–§</h3>
        <p>
          –°—Ä–µ–¥–Ω–µ–≥–æ–¥–æ–≤—ã–µ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç –∫ —Ä—É–±–ª—é, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ü–µ–Ω –Ω–∞
          –¥–∞—Ç—É –∞—É–∫—Ü–∏–æ–Ω–∞:
        </p>
        <div class="rates-table-container">
          <table class="rates-table" id="ratesTable">
            <thead>
              <tr>
                <th>–ì–æ–¥</th>
                <th>USD</th>
                <th>EUR</th>
                <th>GBP</th>
                <th>CHF</th>
                <th>SEK</th>
                <th>DKK</th>
              </tr>
            </thead>
            <tbody id="ratesTableBody">
              <!-- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </tbody>
          </table>
        </div>
        <p class="rates-source">
          –ò—Å—Ç–æ—á–Ω–∏–∫: –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ä–µ–¥–Ω–µ–≥–æ–¥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
          –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫–∞ –†–§. –î–ª—è —Ç–æ—á–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
          –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å
          <a
            href="https://www.cbr.ru/currency_base/dynamics/"
            target="_blank"
            style="color: #ffd700"
            >cbr.ru</a
          >
        </p>
      </div>
    </div>

    <script>
      let artworksData = [];
      let currentArtistFolder = "";
      let lightboxImages = [];
      let currentLightboxIndex = 0;

      let currentRates = {
        USD: 88,
        EUR: 95,
        GBP: 112,
        CHF: 100,
        SEK: 8,
        DKK: 13,
        RUR: 1,
        RUB: 1,
      };

      const historicalRates = {
        2007: {
          USD: 25.6,
          EUR: 34.7,
          GBP: 51.1,
          CHF: 21.2,
          SEK: 3.7,
          DKK: 4.6,
        },
        2008: {
          USD: 24.9,
          EUR: 36.4,
          GBP: 46.0,
          CHF: 23.1,
          SEK: 3.9,
          DKK: 4.9,
        },
        2009: {
          USD: 31.8,
          EUR: 44.1,
          GBP: 49.6,
          CHF: 29.5,
          SEK: 4.3,
          DKK: 5.9,
        },
        2010: {
          USD: 30.4,
          EUR: 40.3,
          GBP: 47.1,
          CHF: 29.3,
          SEK: 4.4,
          DKK: 5.4,
        },
        2011: {
          USD: 29.4,
          EUR: 40.9,
          GBP: 47.1,
          CHF: 33.3,
          SEK: 4.5,
          DKK: 5.5,
        },
        2012: {
          USD: 31.1,
          EUR: 39.9,
          GBP: 49.3,
          CHF: 33.2,
          SEK: 4.6,
          DKK: 5.4,
        },
        2013: {
          USD: 31.8,
          EUR: 42.3,
          GBP: 49.5,
          CHF: 34.7,
          SEK: 4.9,
          DKK: 5.7,
        },
        2014: {
          USD: 38.6,
          EUR: 51.0,
          GBP: 62.0,
          CHF: 40.8,
          SEK: 5.4,
          DKK: 6.8,
        },
        2015: {
          USD: 61.0,
          EUR: 68.0,
          GBP: 92.0,
          CHF: 63.0,
          SEK: 7.2,
          DKK: 9.1,
        },
        2016: {
          USD: 67.0,
          EUR: 74.0,
          GBP: 87.0,
          CHF: 68.0,
          SEK: 7.7,
          DKK: 9.9,
        },
        2017: {
          USD: 58.3,
          EUR: 65.9,
          GBP: 75.3,
          CHF: 59.7,
          SEK: 6.9,
          DKK: 8.9,
        },
        2018: {
          USD: 62.7,
          EUR: 74.0,
          GBP: 83.8,
          CHF: 63.9,
          SEK: 7.1,
          DKK: 9.9,
        },
        2019: {
          USD: 64.7,
          EUR: 72.5,
          GBP: 82.9,
          CHF: 65.1,
          SEK: 6.8,
          DKK: 9.7,
        },
        2020: {
          USD: 72.1,
          EUR: 84.3,
          GBP: 93.6,
          CHF: 79.2,
          SEK: 8.2,
          DKK: 11.3,
        },
        2021: {
          USD: 73.7,
          EUR: 87.2,
          GBP: 101.0,
          CHF: 80.7,
          SEK: 8.5,
          DKK: 11.7,
        },
        2022: {
          USD: 68.5,
          EUR: 72.3,
          GBP: 83.5,
          CHF: 71.5,
          SEK: 6.6,
          DKK: 9.7,
        },
        2023: {
          USD: 89.7,
          EUR: 97.9,
          GBP: 111.9,
          CHF: 101.2,
          SEK: 8.4,
          DKK: 13.1,
        },
        2024: {
          USD: 92.0,
          EUR: 100.0,
          GBP: 116.0,
          CHF: 104.0,
          SEK: 8.5,
          DKK: 13.4,
        },
        2025: {
          USD: 88.0,
          EUR: 95.0,
          GBP: 112.0,
          CHF: 100.0,
          SEK: 8.0,
          DKK: 13.0,
        },
      };

      function loadSelectedArtist() {
        const select = document.getElementById("artistSelect");
        const fileInput = document.getElementById("fileInput");

        if (fileInput.files.length > 0) {
          loadFromFile(fileInput.files[0]);
        } else if (select.value) {
          loadFromUrl(select.value);
        } else {
          alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ö—É–¥–æ–∂–Ω–∏–∫–∞ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª");
        }
      }

      async function loadFromUrl(url) {
        try {
          showLoading();
          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–∞–ø–∫—É —Ö—É–¥–æ–∂–Ω–∏–∫–∞ –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
          currentArtistFolder = url.replace(".json", "");
          const response = await fetch(url);
          if (!response.ok) throw new Error("–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω");
          const data = await response.json();
          processData(data);
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", error);
          showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: " + error.message);
        }
      }

      function loadFromFile(file) {
        const reader = new FileReader();
        currentArtistFolder = file.name.replace(".json", "").toLowerCase();
        reader.onload = function (e) {
          try {
            const data = JSON.parse(e.target.result);
            processData(data);
          } catch (error) {
            showError("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è JSON —Ñ–∞–π–ª–∞: " + error.message);
          }
        };
        reader.readAsText(file);
      }

      function processData(data) {
        document.getElementById("artistName").textContent =
          data.artist || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ö—É–¥–æ–∂–Ω–∏–∫";
        document.getElementById("dataSource").textContent =
          data.data_source || "";
        document.getElementById("mainContent").classList.remove("hidden");

        artworksData = (data.artworks || []).map((artwork, index) => ({
          ...artwork,
          index,
          parsedDimensions: parseDimensions(artwork.dimensions_cm),
          lastSaleDate: parseDate(
            artwork.latest_sale_details?.date ||
              (artwork.sales_history && artwork.sales_history.length > 0
                ? artwork.sales_history[0].date
                : null)
          ),
        }));

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–Ω–µ–ª—å –≤–∞–ª—é—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
        const usedCurrencies = getUsedCurrencies(data.artworks || []);
        updateCurrencyPanel(usedCurrencies);

        updateDisplay();
      }

      function showLoading() {
        document.getElementById("artworksGrid").innerHTML = `
          <div class="loading">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
          </div>
        `;
      }

      function showError(message) {
        document.getElementById("artworksGrid").innerHTML = `
          <div class="empty-state">
            <p>${message}</p>
          </div>
        `;
      }

      function parseDimensions(dimStr) {
        if (!dimStr) return { width: null, height: null, area: null };

        const cleaned = dimStr.replace(/,/g, ".").replace(/\s/g, "");
        const match = cleaned.match(/(\d+(?:\.\d+)?)[—Öx–•X√ó](\d+(?:\.\d+)?)/);

        if (match) {
          const height = parseFloat(match[1]);
          const width = parseFloat(match[2]);
          return { height, width, area: height * width };
        }

        return { width: null, height: null, area: null };
      }

      function parseDate(dateStr) {
        if (!dateStr) return null;
        const parts = dateStr.split(".");
        if (parts.length === 3) {
          return new Date(parts[2], parts[1] - 1, parts[0]);
        }
        return null;
      }

      function getYearFromDate(dateStr) {
        if (!dateStr) return null;
        const parts = dateStr.split(".");
        if (parts.length === 3) {
          return parseInt(parts[2]);
        }
        return null;
      }

      function isSold(artwork) {
        const salePrice = artwork.latest_sale_details?.sale_price || "";
        const lower = salePrice.toLowerCase();
        return (
          salePrice &&
          !lower.includes("–Ω–µ –ø—Ä–æ–¥–∞–Ω") &&
          !lower.includes("–Ω–µ—Ç") &&
          !lower.includes("–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞") &&
          salePrice.match(/[\d\s]+\s*(USD|EUR|GBP|CHF|RUR|RUB)/i)
        );
      }

      function parsePriceValue(priceStr) {
        if (!priceStr) return null;
        const cleaned = priceStr.replace(/\s/g, "").replace(/,/g, ".");
        const match = cleaned.match(/([\d.]+)\s*(USD|EUR|GBP|CHF|RUR|RUB)/i);
        if (match) {
          return {
            amount: parseFloat(match[1]),
            currency: match[2].toUpperCase(),
          };
        }
        return null;
      }

      function convertToRub(priceData, rates) {
        if (!priceData) return null;
        const rate = rates[priceData.currency] || 1;
        return priceData.amount * rate;
      }

      function formatRub(amount) {
        if (amount === null) return "";
        return new Intl.NumberFormat("ru-RU", {
          style: "currency",
          currency: "RUB",
          maximumFractionDigits: 0,
        }).format(amount);
      }

      function getHistoricalRate(year, currency) {
        if (!year || !currency) return null;
        const yearRates = historicalRates[year];
        if (yearRates && yearRates[currency]) {
          return yearRates[currency];
        }
        const years = Object.keys(historicalRates)
          .map(Number)
          .sort((a, b) => a - b);
        const closest = years.reduce((prev, curr) =>
          Math.abs(curr - year) < Math.abs(prev - year) ? curr : prev
        );
        return historicalRates[closest]?.[currency] || null;
      }

      function filterAndSort() {
        const searchTitle = document
          .getElementById("searchTitle")
          .value.toLowerCase();
        const minWidth =
          parseFloat(document.getElementById("minWidth").value) || 0;
        const maxWidth =
          parseFloat(document.getElementById("maxWidth").value) || Infinity;
        const minHeight =
          parseFloat(document.getElementById("minHeight").value) || 0;
        const maxHeight =
          parseFloat(document.getElementById("maxHeight").value) || Infinity;
        const minArea =
          parseFloat(document.getElementById("minArea").value) || 0;
        const maxArea =
          parseFloat(document.getElementById("maxArea").value) || Infinity;
        const dateFrom = document.getElementById("dateFrom").value
          ? new Date(document.getElementById("dateFrom").value)
          : null;
        const dateTo = document.getElementById("dateTo").value
          ? new Date(document.getElementById("dateTo").value)
          : null;
        const sortBy = document.getElementById("sortBy").value;
        const saleStatus = document.getElementById("saleStatus").value;

        let filtered = artworksData.filter((artwork) => {
          if (
            searchTitle &&
            !artwork.title.toLowerCase().includes(searchTitle)
          ) {
            return false;
          }

          const dim = artwork.parsedDimensions;
          if (dim.width !== null) {
            if (dim.width < minWidth || dim.width > maxWidth) return false;
          }
          if (dim.height !== null) {
            if (dim.height < minHeight || dim.height > maxHeight) return false;
          }
          if (dim.area !== null) {
            if (dim.area < minArea || dim.area > maxArea) return false;
          }

          if (
            dateFrom &&
            artwork.lastSaleDate &&
            artwork.lastSaleDate < dateFrom
          ) {
            return false;
          }
          if (dateTo && artwork.lastSaleDate && artwork.lastSaleDate > dateTo) {
            return false;
          }

          if (saleStatus === "sold" && !isSold(artwork)) return false;
          if (saleStatus === "not-sold" && isSold(artwork)) return false;

          return true;
        });

        filtered.sort((a, b) => {
          switch (sortBy) {
            case "date-desc":
              return (b.lastSaleDate || 0) - (a.lastSaleDate || 0);
            case "date-asc":
              return (a.lastSaleDate || 0) - (b.lastSaleDate || 0);
            case "width-asc":
              return (
                (a.parsedDimensions.width || 0) -
                (b.parsedDimensions.width || 0)
              );
            case "width-desc":
              return (
                (b.parsedDimensions.width || 0) -
                (a.parsedDimensions.width || 0)
              );
            case "height-asc":
              return (
                (a.parsedDimensions.height || 0) -
                (b.parsedDimensions.height || 0)
              );
            case "height-desc":
              return (
                (b.parsedDimensions.height || 0) -
                (a.parsedDimensions.height || 0)
              );
            case "area-asc":
              return (
                (a.parsedDimensions.area || 0) - (b.parsedDimensions.area || 0)
              );
            case "area-desc":
              return (
                (b.parsedDimensions.area || 0) - (a.parsedDimensions.area || 0)
              );
            case "title-asc":
              return a.title.localeCompare(b.title, "ru");
            case "title-desc":
              return b.title.localeCompare(a.title, "ru");
            default:
              return 0;
          }
        });

        return filtered;
      }

      function updateDisplay() {
        const filtered = filterAndSort();

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        document.getElementById("totalWorks").textContent = artworksData.length;
        document.getElementById("filteredWorks").textContent = filtered.length;
        document.getElementById("soldWorks").textContent =
          filtered.filter(isSold).length;
        document.getElementById("notSoldWorks").textContent = filtered.filter(
          (a) => !isSold(a)
        ).length;

        // –°–æ–±–∏—Ä–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è lightbox
        lightboxImages = filtered
          .filter((a) => a.image)
          .map((a) => ({
            src: `images/${currentArtistFolder}/${a.image}`,
            title: a.title,
          }));

        const grid = document.getElementById("artworksGrid");

        if (filtered.length === 0) {
          grid.innerHTML =
            '<div class="empty-state"><p>–ù–µ—Ç —Ä–∞–±–æ—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∏–ª—å—Ç—Ä–∞–º</p></div>';
          return;
        }

        const priceMode = document.getElementById("priceMode").value;

        grid.innerHTML = filtered
          .map((artwork, displayIndex) => {
            const dim = artwork.parsedDimensions;
            const sale = artwork.latest_sale_details || {};
            const soldStatus = isSold(artwork);
            const salePrice = parsePriceValue(sale.sale_price);
            const year = getYearFromDate(sale.date);

            let priceRubCurrent = "";
            let priceRubHistorical = "";

            if (
              salePrice &&
              (priceMode === "both" || priceMode === "current")
            ) {
              const rubCurrent = convertToRub(salePrice, currentRates);
              if (rubCurrent) {
                priceRubCurrent = `<span class="price-rub">(${formatRub(
                  rubCurrent
                )} –ø–æ —Ç–µ–∫—É—â–µ–º—É –∫—É—Ä—Å—É)</span>`;
              }
            }

            if (
              salePrice &&
              year &&
              (priceMode === "both" || priceMode === "historical")
            ) {
              const histRate = getHistoricalRate(year, salePrice.currency);
              if (histRate) {
                const rubHist = salePrice.amount * histRate;
                priceRubHistorical = `<span class="price-rub-historical">(${formatRub(
                  rubHist
                )} –ø–æ –∫—É—Ä—Å—É ${year}–≥.)</span>`;
              }
            }

            // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            let imageHtml = "";
            if (artwork.image) {
              const imageSrc = `images/${currentArtistFolder}/${artwork.image}`;
              const imgIndex = lightboxImages.findIndex(
                (img) => img.src === imageSrc
              );
              imageHtml = `
                <div class="artwork-image-container">
                  <img class="artwork-image" 
                       src="${imageSrc}" 
                       alt="${artwork.title}"
                       onclick="openLightbox(${imgIndex})"
                       onerror="this.parentElement.innerHTML='<div class=\\'artwork-image-placeholder\\'>üñºÔ∏è</div>'" />
                </div>
              `;
            } else {
              imageHtml = `
                <div class="artwork-image-container">
                  <div class="artwork-image-placeholder">üñºÔ∏è</div>
                </div>
              `;
            }

            return `
              <div class="artwork-card">
                ${imageHtml}
                <div class="artwork-content">
                  <div class="artwork-header">
                    <h3 class="artwork-title">${artwork.title}</h3>
                    ${
                      artwork.creation_year
                        ? `<span class="artwork-year">${artwork.creation_year}</span>`
                        : ""
                    }
                  </div>
                  
                  <div class="artwork-details">
                    ${
                      dim.width
                        ? `
                      <div class="detail-item">
                        <div class="detail-label">–†–∞–∑–º–µ—Ä—ã</div>
                        <div class="detail-value">
                          <span class="dimensions-badge">${dim.height} √ó ${
                            dim.width
                          } —Å–º</span>
                          ${
                            dim.area
                              ? `<span class="area-badge">${Math.round(
                                  dim.area
                                )} —Å–º¬≤</span>`
                              : ""
                          }
                        </div>
                      </div>
                    `
                        : ""
                    }
                    ${
                      artwork.technique
                        ? `
                      <div class="detail-item">
                        <div class="detail-label">–¢–µ—Ö–Ω–∏–∫–∞</div>
                        <div class="detail-value">${artwork.technique}</div>
                      </div>
                    `
                        : ""
                    }
                    ${
                      sale.auction_house
                        ? `
                      <div class="detail-item">
                        <div class="detail-label">–ê—É–∫—Ü–∏–æ–Ω</div>
                        <div class="detail-value">${sale.auction_house}</div>
                      </div>
                    `
                        : ""
                    }
                    ${
                      sale.date
                        ? `
                      <div class="detail-item">
                        <div class="detail-label">–î–∞—Ç–∞</div>
                        <div class="detail-value">${sale.date}</div>
                      </div>
                    `
                        : ""
                    }
                  </div>
                  
                  <div class="price-display">
                    ${
                      sale.estimate
                        ? `
                      <div class="price-row">
                        <span class="price-label">–≠—Å—Ç–∏–º–µ–π—Ç:</span>
                        <span class="price-value">${sale.estimate}</span>
                      </div>
                    `
                        : ""
                    }
                    <div class="price-row">
                      <span class="price-label">–†–µ–∑—É–ª—å—Ç–∞—Ç:</span>
                      <span class="price-value ${
                        soldStatus ? "sold" : "not-sold"
                      }">
                        ${sale.sale_price || "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"}
                      </span>
                    </div>
                    ${
                      priceRubCurrent || priceRubHistorical
                        ? `
                      <div class="price-row">
                        <span class="price-label">–í —Ä—É–±–ª—è—Ö:</span>
                        <span class="price-value">
                          ${priceRubCurrent}
                          ${priceRubHistorical}
                        </span>
                      </div>
                    `
                        : ""
                    }
                  </div>
                  
                  ${
                    artwork.sales_history && artwork.sales_history.length > 0
                      ? `
                    <div class="sales-history">
                      <button class="history-toggle" onclick="toggleHistory(this)">
                        <span>–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–∞–∂ (${
                          artwork.sales_history.length
                        })</span>
                        <span>‚ñº</span>
                      </button>
                      <div class="history-content">
                        ${artwork.sales_history
                          .map(
                            (sale) => `
                          <div class="history-item">
                            <div class="history-date">${
                              sale.date || "–ù–µ—Ç –¥–∞—Ç—ã"
                            }</div>
                            <div class="history-auction">${
                              sale.auction_house || ""
                            }</div>
                            <div class="history-prices">
                              ${
                                sale.estimate
                                  ? `<span>–≠—Å—Ç–∏–º–µ–π—Ç: ${sale.estimate}</span>`
                                  : ""
                              }
                              ${
                                sale.result
                                  ? `<span>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${sale.result}</span>`
                                  : ""
                              }
                            </div>
                          </div>
                        `
                          )
                          .join("")}
                      </div>
                    </div>
                  `
                      : ""
                  }
                </div>
              </div>
            `;
          })
          .join("");
      }

      function toggleHistory(btn) {
        const content = btn.nextElementSibling;
        content.classList.toggle("show");
        btn.querySelector("span:last-child").textContent =
          content.classList.contains("show") ? "‚ñ≤" : "‚ñº";
      }

      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–∏–µ –≤–∞–ª—é—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
      function getUsedCurrencies(artworks) {
        const currencies = new Set();
        const currencyRegex =
          /\b(USD|EUR|GBP|CHF|SEK|DKK|NOK|PLN|CZK|HUF|AUD|CAD|JPY|CNY)\b/gi;

        artworks.forEach((artwork) => {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–µ–Ω—É –ø—Ä–æ–¥–∞–∂–∏
          const salePrice = artwork.latest_sale_details?.sale_price || "";
          const saleMatches = salePrice.match(currencyRegex);
          if (saleMatches)
            saleMatches.forEach((c) => currencies.add(c.toUpperCase()));

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç—Å—Ç–∏–º–µ–π—Ç
          const estimate = artwork.latest_sale_details?.estimate || "";
          const estMatches = estimate.match(currencyRegex);
          if (estMatches)
            estMatches.forEach((c) => currencies.add(c.toUpperCase()));

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ–¥–∞–∂
          if (artwork.sales_history) {
            artwork.sales_history.forEach((sale) => {
              const histPrice = sale.sale_price || "";
              const histMatches = histPrice.match(currencyRegex);
              if (histMatches)
                histMatches.forEach((c) => currencies.add(c.toUpperCase()));
            });
          }
        });

        return Array.from(currencies).sort();
      }

      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞ –∫—É—Ä—Å–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤–∞–ª—é—Ç
      function updateCurrencyPanel(currencies) {
        const container = document.getElementById("rateInputsContainer");
        const panelGroup = document.getElementById("currencyRatesGroup");

        if (currencies.length === 0) {
          panelGroup.style.display = "none";
          return;
        }

        panelGroup.style.display = "";
        container.innerHTML = currencies
          .map((currency) => {
            const defaultRate = currentRates[currency] || 1;
            return `
            <div class="rate-input-group">
              <span class="rate-label">${currency}</span>
              <input type="number" id="rate${currency}" value="${defaultRate}" step="0.01" />
            </div>
          `;
          })
          .join("");
      }

      function updateRates() {
        // –ß–∏—Ç–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª–µ–π
        const inputs = document.querySelectorAll(
          '#rateInputsContainer input[type="number"]'
        );
        inputs.forEach((input) => {
          const currency = input.id.replace("rate", "");
          currentRates[currency] =
            parseFloat(input.value) || currentRates[currency] || 1;
        });
        updateDisplay();
      }

      function resetFilters() {
        document.getElementById("searchTitle").value = "";
        document.getElementById("minWidth").value = "";
        document.getElementById("maxWidth").value = "";
        document.getElementById("minHeight").value = "";
        document.getElementById("maxHeight").value = "";
        document.getElementById("minArea").value = "";
        document.getElementById("maxArea").value = "";
        document.getElementById("dateFrom").value = "";
        document.getElementById("dateTo").value = "";
        document.getElementById("sortBy").value = "date-desc";
        document.getElementById("saleStatus").value = "all";
        updateDisplay();
      }

      // Lightbox —Ñ—É–Ω–∫—Ü–∏–∏
      function openLightbox(index) {
        if (index < 0 || index >= lightboxImages.length) return;
        currentLightboxIndex = index;
        const img = lightboxImages[index];
        document.getElementById("lightbox-image").src = img.src;
        document.getElementById("lightbox-caption").textContent = img.title;
        document.getElementById("lightbox").classList.add("active");
        document.body.style.overflow = "hidden";
      }

      function closeLightbox() {
        document.getElementById("lightbox").classList.remove("active");
        document.body.style.overflow = "";
      }

      // Currency info modal functions
      function showCurrencyInfo() {
        document.getElementById("currencyInfoModal").classList.add("active");
        document.body.style.overflow = "hidden";
      }

      function closeCurrencyInfo(event) {
        if (event && event.target !== event.currentTarget) return;
        document.getElementById("currencyInfoModal").classList.remove("active");
        document.body.style.overflow = "";
      }

      // Historical rates modal functions
      function showHistoricalRates() {
        const tbody = document.getElementById("ratesTableBody");
        const years = Object.keys(historicalRates).sort((a, b) => b - a);

        tbody.innerHTML = years
          .map((year) => {
            const rates = historicalRates[year];
            return `
            <tr>
              <td>${year}</td>
              <td>${rates.USD?.toFixed(2) || "‚Äî"}</td>
              <td>${rates.EUR?.toFixed(2) || "‚Äî"}</td>
              <td>${rates.GBP?.toFixed(2) || "‚Äî"}</td>
              <td>${rates.CHF?.toFixed(2) || "‚Äî"}</td>
              <td>${rates.SEK?.toFixed(2) || "‚Äî"}</td>
              <td>${rates.DKK?.toFixed(2) || "‚Äî"}</td>
            </tr>
          `;
          })
          .join("");

        document.getElementById("historicalRatesModal").classList.add("active");
        document.body.style.overflow = "hidden";
      }

      function closeHistoricalRates(event) {
        if (event && event.target !== event.currentTarget) return;
        document
          .getElementById("historicalRatesModal")
          .classList.remove("active");
        document.body.style.overflow = "";
      }

      function navigateLightbox(direction) {
        currentLightboxIndex += direction;
        if (currentLightboxIndex < 0)
          currentLightboxIndex = lightboxImages.length - 1;
        if (currentLightboxIndex >= lightboxImages.length)
          currentLightboxIndex = 0;
        const img = lightboxImages[currentLightboxIndex];
        document.getElementById("lightbox-image").src = img.src;
        document.getElementById("lightbox-caption").textContent = img.title;
      }

      // –ó–∞–∫—Ä—ã—Ç–∏–µ lightbox –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
      document
        .getElementById("lightbox")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeLightbox();
          }
        });

      // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è lightbox
      document.addEventListener("keydown", function (e) {
        if (!document.getElementById("lightbox").classList.contains("active"))
          return;
        if (e.key === "Escape") closeLightbox();
        if (e.key === "ArrowLeft") navigateLightbox(-1);
        if (e.key === "ArrowRight") navigateLightbox(1);
      });

      // –ó–∞–∫—Ä—ã—Ç–∏–µ info modal –ø–æ Escape
      document.addEventListener("keydown", function (e) {
        if (
          document
            .getElementById("currencyInfoModal")
            .classList.contains("active")
        ) {
          if (e.key === "Escape") closeCurrencyInfo();
        }
        if (
          document
            .getElementById("historicalRatesModal")
            .classList.contains("active")
        ) {
          if (e.key === "Escape") closeHistoricalRates();
        }
      });

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
      document
        .getElementById("searchTitle")
        .addEventListener("input", updateDisplay);
      document
        .getElementById("minWidth")
        .addEventListener("input", updateDisplay);
      document
        .getElementById("maxWidth")
        .addEventListener("input", updateDisplay);
      document
        .getElementById("minHeight")
        .addEventListener("input", updateDisplay);
      document
        .getElementById("maxHeight")
        .addEventListener("input", updateDisplay);
      document
        .getElementById("minArea")
        .addEventListener("input", updateDisplay);
      document
        .getElementById("maxArea")
        .addEventListener("input", updateDisplay);
      document
        .getElementById("dateFrom")
        .addEventListener("change", updateDisplay);
      document
        .getElementById("dateTo")
        .addEventListener("change", updateDisplay);
      document
        .getElementById("sortBy")
        .addEventListener("change", updateDisplay);
      document
        .getElementById("saleStatus")
        .addEventListener("change", updateDisplay);
      document
        .getElementById("priceMode")
        .addEventListener("change", updateDisplay);
      document
        .getElementById("artistSelect")
        .addEventListener("change", function () {
          document.getElementById("fileInput").value = "";
        });
      document
        .getElementById("fileInput")
        .addEventListener("change", function () {
          if (this.files.length > 0) {
            document.getElementById("artistSelect").value = "";
          }
        });
    </script>
  </body>
</html>
