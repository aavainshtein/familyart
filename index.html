<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ê—É–∫—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏ —Ö—É–¥–æ–∂–Ω–∏–∫–æ–≤</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        min-height: 100vh;
        color: #e4e4e4;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        backdrop-filter: blur(10px);
      }

      h1 {
        font-size: 2.2em;
        margin-bottom: 10px;
        color: #ffd700;
      }

      .subtitle {
        color: #888;
        font-size: 0.9em;
      }

      .artist-selector {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 30px;
        padding: 20px;
        background: rgba(76, 175, 80, 0.1);
        border-radius: 15px;
        border: 1px solid rgba(76, 175, 80, 0.2);
        align-items: flex-end;
      }

      .artist-selector .control-group {
        flex: 1;
        min-width: 250px;
      }

      .artist-selector .control-group:last-child {
        flex: 0 0 auto;
        min-width: 180px;
      }

      .file-input-wrapper {
        position: relative;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .file-input-wrapper select {
        flex: 1;
        min-width: 200px;
      }

      .file-input-wrapper input[type="file"] {
        display: none;
      }

      .file-input-label {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        border: 1px dashed rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.05);
        color: #aaa;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        white-space: nowrap;
      }

      .file-input-label:hover {
        border-color: #ffd700;
        color: #ffd700;
        background: rgba(255, 215, 0, 0.1);
      }

      .controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
      }

      .input-pair {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .input-pair input {
        flex: 1;
        min-width: 100px;
      }

      .control-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
        position: relative;
      }

      .control-group select,
      .control-group button {
        width: 100%;
      }

      .control-group label {
        font-weight: 600;
        color: #aaa;
        font-size: 0.85em;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      input,
      select,
      button {
        padding: 12px 16px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.08);
        color: #fff;
        font-size: 14px;
        transition: all 0.3s ease;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #ffd700;
        box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
      }

      select {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23fff' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        padding-right: 36px;
        cursor: pointer;
      }

      select option {
        background: #1a1a2e;
        color: #fff;
      }

      button {
        cursor: pointer;
        background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
        color: #1a1a2e;
        font-weight: 600;
        border: none;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
      }

      button.secondary {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      button.secondary:hover {
        background: rgba(255, 255, 255, 0.15);
        box-shadow: none;
      }

      .currency-panel {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 30px;
        padding: 20px;
        background: rgba(255, 215, 0, 0.1);
        border-radius: 15px;
        border: 1px solid rgba(255, 215, 0, 0.2);
        align-items: flex-end;
      }

      .currency-panel .control-group {
        flex: 1;
        min-width: 250px;
      }

      .currency-panel .control-group:first-child {
        flex: 2;
        min-width: 350px;
      }

      .currency-panel .control-group:last-child {
        flex: 0 0 auto;
        min-width: 150px;
      }

      .rate-inputs {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .rate-input-group {
        display: flex;
        flex-direction: column;
        gap: 4px;
        flex: 1;
        min-width: 70px;
      }

      .rate-label {
        font-size: 0.75em;
        color: #ffd700;
        font-weight: 600;
        text-align: center;
      }

      .rate-input-group input {
        width: 100%;
        text-align: center;
      }

      /* Info button styles */
      .info-btn {
        background: rgba(255, 215, 0, 0.2);
        border: 1px solid #ffd700;
        color: #ffd700;
        width: 22px !important;
        height: 22px !important;
        min-width: 22px;
        max-width: 22px;
        min-height: 22px;
        max-height: 22px;
        flex: 0 0 22px;
        border-radius: 50%;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-left: 8px;
        transition: all 0.2s;
        padding: 0;
        line-height: 1;
        vertical-align: middle;
      }

      .info-btn:hover {
        background: #ffd700;
        color: #1a1a2e;
      }

      .label-with-info {
        display: inline-flex;
        align-items: center;
        width: auto;
      }

      /* Rates table styles */
      .rates-table-container {
        max-height: 400px;
        overflow-y: auto;
        margin-top: 15px;
      }

      .rates-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9em;
      }

      .rates-table th,
      .rates-table td {
        padding: 8px 12px;
        text-align: right;
        border-bottom: 1px solid rgba(255, 215, 0, 0.2);
      }

      .rates-table th {
        background: rgba(255, 215, 0, 0.15);
        color: #ffd700;
        position: sticky;
        top: 0;
        text-align: center;
      }

      .rates-table th:first-child,
      .rates-table td:first-child {
        text-align: left;
        font-weight: 600;
        color: #ffd700;
      }

      .rates-table tr:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      .rates-source {
        margin-top: 15px;
        font-size: 0.85em;
        color: #888;
        font-style: italic;
      }

      /* Info modal styles */
      .info-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 2000;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .info-modal.active {
        display: flex;
      }

      .info-modal-content {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        border: 1px solid rgba(255, 215, 0, 0.3);
        border-radius: 15px;
        padding: 30px;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
      }

      .info-modal-content h3 {
        color: #ffd700;
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 1.4em;
      }

      .info-modal-content p {
        color: #e0e0e0;
        line-height: 1.6;
        margin-bottom: 15px;
      }

      .info-modal-content ul {
        color: #e0e0e0;
        padding-left: 20px;
        margin-bottom: 15px;
      }

      .info-modal-content li {
        margin-bottom: 8px;
        line-height: 1.5;
      }

      .info-modal-content strong {
        color: #ffd700;
      }

      .info-modal-close {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        color: #888;
        font-size: 28px;
        cursor: pointer;
        transition: color 0.2s;
      }

      .info-modal-close:hover {
        color: #ffd700;
      }

      .stats {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 30px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
      }

      .stat-item {
        text-align: center;
        padding: 10px 20px;
      }

      .stat-value {
        font-size: 1.8em;
        font-weight: bold;
        color: #ffd700;
      }

      .stat-label {
        font-size: 0.85em;
        color: #888;
      }

      .artworks-grid {
        display: grid;
        gap: 20px;
      }

      .artwork-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 25px;
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        gap: 20px;
      }

      .artwork-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        border-color: rgba(255, 215, 0, 0.3);
      }

      .artwork-image-container {
        flex: 0 0 150px;
        display: flex;
        align-items: flex-start;
      }

      .artwork-image {
        width: 150px;
        height: 150px;
        object-fit: cover;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid rgba(255, 255, 255, 0.1);
      }

      .artwork-image:hover {
        border-color: #ffd700;
        transform: scale(1.05);
      }

      .artwork-image-placeholder {
        width: 150px;
        height: 150px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #555;
        font-size: 3em;
      }

      .artwork-content {
        flex: 1;
        min-width: 0;
      }

      .artwork-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
        gap: 15px;
      }

      .artwork-title {
        font-size: 1.3em;
        font-weight: 600;
        color: #fff;
        flex: 1;
      }

      .artwork-year {
        background: rgba(255, 215, 0, 0.2);
        color: #ffd700;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.85em;
        white-space: nowrap;
      }

      .artwork-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .detail-item {
        background: rgba(0, 0, 0, 0.2);
        padding: 12px;
        border-radius: 8px;
      }

      .detail-label {
        font-size: 0.75em;
        color: #888;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 5px;
      }

      .detail-value {
        font-size: 1em;
        color: #fff;
      }

      .price-display {
        background: linear-gradient(
          135deg,
          rgba(255, 215, 0, 0.15) 0%,
          rgba(255, 170, 0, 0.1) 100%
        );
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 15px;
      }

      .price-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        flex-wrap: wrap;
        gap: 10px;
      }

      .price-row:last-child {
        border-bottom: none;
      }

      .price-label {
        color: #aaa;
        font-size: 0.9em;
      }

      .price-value {
        font-weight: 600;
        color: #fff;
      }

      .price-rub {
        color: #4caf50;
        font-size: 0.85em;
      }

      .price-rub-historical {
        color: #ff9800;
        font-size: 0.85em;
      }

      .sales-history {
        margin-top: 15px;
      }

      .history-toggle {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        width: 100%;
        text-align: left;
        color: #fff;
        padding: 10px 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .history-toggle:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: none;
        box-shadow: none;
      }

      .history-content {
        display: none;
        margin-top: 10px;
        padding: 15px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
      }

      .history-content.show {
        display: block;
      }

      .history-item {
        padding: 12px;
        margin-bottom: 10px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        border-left: 3px solid #ffd700;
      }

      .history-item:last-child {
        margin-bottom: 0;
      }

      .history-date {
        font-weight: 600;
        color: #ffd700;
        margin-bottom: 5px;
      }

      .history-auction {
        font-size: 0.9em;
        color: #aaa;
        margin-bottom: 8px;
      }

      .history-prices {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        font-size: 0.9em;
      }

      .sold {
        color: #4caf50;
      }

      .not-sold {
        color: #f44336;
      }

      .no-data {
        color: #888;
        font-style: italic;
      }

      .loading {
        text-align: center;
        padding: 50px;
        color: #888;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 3px solid rgba(255, 215, 0, 0.1);
        border-top-color: #ffd700;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .empty-state {
        text-align: center;
        padding: 50px;
        color: #888;
      }

      .welcome-state {
        text-align: center;
        padding: 80px 20px;
        color: #888;
      }

      .welcome-state h2 {
        color: #ffd700;
        margin-bottom: 20px;
        font-size: 1.5em;
      }

      .welcome-state p {
        margin-bottom: 10px;
        line-height: 1.6;
      }

      .dimensions-badge {
        display: inline-block;
        background: rgba(100, 149, 237, 0.2);
        color: #6495ed;
        padding: 4px 10px;
        border-radius: 15px;
        font-size: 0.85em;
        margin-right: 5px;
      }

      .area-badge {
        display: inline-block;
        background: rgba(147, 112, 219, 0.2);
        color: #9370db;
        padding: 4px 10px;
        border-radius: 15px;
        font-size: 0.85em;
      }

      footer {
        text-align: center;
        margin-top: 40px;
        padding: 20px;
        color: #666;
        font-size: 0.85em;
      }

      .hidden {
        display: none !important;
      }

      /* Lightbox —Å—Ç–∏–ª–∏ */
      .lightbox {
        display: none;
        position: fixed;
        z-index: 9999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.95);
        backdrop-filter: blur(10px);
      }

      .lightbox.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .lightbox-content {
        max-width: 90%;
        max-height: 90%;
        position: relative;
      }

      .lightbox-image {
        max-width: 100%;
        max-height: 85vh;
        border-radius: 10px;
        box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
      }

      .lightbox-caption {
        text-align: center;
        color: #fff;
        padding: 15px;
        font-size: 1.1em;
      }

      .lightbox-close {
        position: absolute;
        top: 20px;
        right: 30px;
        color: #fff;
        font-size: 40px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.3s;
        z-index: 10000;
      }

      .lightbox-close:hover {
        color: #ffd700;
      }

      .lightbox-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        color: #fff;
        font-size: 50px;
        font-weight: bold;
        cursor: pointer;
        padding: 20px;
        transition: color 0.3s;
        user-select: none;
      }

      .lightbox-nav:hover {
        color: #ffd700;
      }

      .lightbox-prev {
        left: 20px;
      }

      .lightbox-next {
        right: 20px;
      }

      @media (max-width: 768px) {
        .artwork-card {
          flex-direction: column;
        }

        .artwork-image-container {
          flex: none;
          width: 100%;
          justify-content: center;
        }

        .artwork-image,
        .artwork-image-placeholder {
          width: 200px;
          height: 200px;
        }

        .controls {
          grid-template-columns: 1fr;
        }

        .artwork-header {
          flex-direction: column;
        }

        .stats {
          flex-direction: column;
        }

        .currency-panel {
          flex-direction: column;
        }

        .currency-panel .control-group,
        .currency-panel .control-group:first-child,
        .currency-panel .control-group:last-child {
          flex: 1 1 100%;
          min-width: 100%;
        }

        .rate-inputs {
          flex-wrap: wrap;
        }

        .rate-inputs input {
          flex: 1 1 45%;
          min-width: 80px;
        }

        .artist-selector {
          flex-direction: column;
        }

        .artist-selector .control-group {
          min-width: 100%;
        }

        .lightbox-nav {
          font-size: 30px;
          padding: 10px;
        }

        .lightbox-prev {
          left: 5px;
        }

        .lightbox-next {
          right: 5px;
        }
      }

      /* Analytics & Calculator Panel */
      .analytics-panel {
        background: rgba(255, 215, 0, 0.08);
        border: 1px solid rgba(255, 215, 0, 0.3);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 25px;
      }

      .analytics-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        cursor: pointer;
      }

      .analytics-header h2 {
        color: #ffd700;
        font-size: 1.3em;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .analytics-toggle {
        background: none;
        border: 1px solid #ffd700;
        color: #ffd700;
        padding: 5px 15px;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .analytics-toggle:hover {
        background: rgba(255, 215, 0, 0.2);
      }

      .analytics-content {
        display: none;
      }

      .analytics-content.expanded {
        display: block;
      }

      .calculator-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      .calc-input-group {
        background: rgba(0, 0, 0, 0.2);
        padding: 15px;
        border-radius: 10px;
      }

      .calc-input-group h3 {
        color: #ffd700;
        font-size: 1em;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .calc-row {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
        align-items: center;
      }

      .calc-row label {
        min-width: 120px;
        color: #aaa;
        font-size: 0.9em;
      }

      .calc-row input,
      .calc-row select {
        flex: 1;
        padding: 8px 12px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 5px;
        color: #fff;
        font-size: 0.9em;
      }

      .calc-row input:focus,
      .calc-row select:focus {
        border-color: #ffd700;
        outline: none;
      }

      .calc-row input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        height: 6px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 3px;
        border: none;
      }

      .calc-row input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 16px;
        height: 16px;
        background: #ffd700;
        border-radius: 50%;
        cursor: pointer;
      }

      .range-value {
        min-width: 50px;
        text-align: center;
        color: #ffd700;
        font-weight: bold;
      }

      .calc-button {
        background: linear-gradient(135deg, #ffd700, #ffaa00);
        color: #1a1a2e;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        width: 100%;
        margin-top: 10px;
      }

      .calc-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
      }

      .results-section {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
      }

      .results-section h3 {
        color: #ffd700;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .price-estimate {
        background: linear-gradient(
          135deg,
          rgba(255, 215, 0, 0.2),
          rgba(255, 170, 0, 0.1)
        );
        border: 2px solid #ffd700;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        margin-bottom: 20px;
      }

      .price-estimate-label {
        color: #aaa;
        font-size: 0.9em;
        margin-bottom: 5px;
      }

      .price-estimate-value {
        color: #ffd700;
        font-size: 1.8em;
        font-weight: bold;
      }

      .price-estimate-note {
        color: #888;
        font-size: 0.8em;
        margin-top: 8px;
      }

      .analytics-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .analytics-stat {
        background: rgba(0, 0, 0, 0.2);
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }

      .analytics-stat-value {
        font-size: 1.5em;
        font-weight: bold;
        color: #4caf50;
      }

      .analytics-stat-value.warning {
        color: #ff9800;
      }

      .analytics-stat-label {
        font-size: 0.8em;
        color: #888;
        margin-top: 5px;
      }

      .comparable-works {
        max-height: 300px;
        overflow-y: auto;
      }

      .comparable-work {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .comparable-work:last-child {
        border-bottom: none;
      }

      .comparable-work-info {
        flex: 1;
      }

      .comparable-work-title {
        font-weight: bold;
        color: #e4e4e4;
        margin-bottom: 3px;
      }

      .comparable-work-details {
        font-size: 0.85em;
        color: #888;
      }

      .comparable-work-price {
        text-align: right;
        min-width: 150px;
      }

      .comparable-work-price-value {
        color: #4caf50;
        font-weight: bold;
      }

      .comparable-work-price-value.foreign {
        color: #2196f3;
        cursor: help;
        border-bottom: 1px dashed #2196f3;
      }

      .comparable-work-price-value.foreign:hover {
        color: #64b5f6;
      }

      .comparable-work-price-value.estimate {
        color: #ff9800;
        cursor: help;
        border-bottom: 1px dashed #ff9800;
      }

      .comparable-work-price-value.estimate:hover {
        color: #ffb74d;
      }

      .comparable-work-price-value.foreign.estimate {
        color: #9c27b0;
        border-bottom: 1px dashed #9c27b0;
      }

      .comparable-work-price-value.foreign.estimate:hover {
        color: #ba68c8;
      }

      .comparable-work-price-original {
        font-size: 0.8em;
        color: #888;
      }

      .warning-box {
        background: rgba(255, 152, 0, 0.15);
        border: 1px solid rgba(255, 152, 0, 0.4);
        border-radius: 8px;
        padding: 12px 15px;
        margin-top: 15px;
        font-size: 0.9em;
        color: #ffcc80;
      }

      .warning-box strong {
        color: #ff9800;
      }

      .no-results-calc {
        text-align: center;
        padding: 30px;
        color: #888;
      }

      @media (max-width: 768px) {
        .calculator-section {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1 id="artistName">–ê—É–∫—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏ —Ö—É–¥–æ–∂–Ω–∏–∫–æ–≤</h1>
        <p class="subtitle" id="dataSource">
          –í—ã–±–µ—Ä–∏—Ç–µ —Ö—É–¥–æ–∂–Ω–∏–∫–∞ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ JSON —Ñ–∞–π–ª
        </p>
      </header>

      <div class="artist-selector">
        <div class="control-group">
          <label>–í—ã–±–æ—Ä —Ö—É–¥–æ–∂–Ω–∏–∫–∞</label>
          <div class="file-input-wrapper">
            <select id="artistSelect">
              <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ö—É–¥–æ–∂–Ω–∏–∫–∞ --</option>
              <option value="bronnikov.json">–ë—Ä–æ–Ω–Ω–∏–∫–æ–≤ –§—ë–¥–æ—Ä –ê–Ω–¥—Ä–µ–µ–≤–∏—á</option>
              <option value="byukhtger.json">–ë—é—Ö—Ç–≥–µ—Ä –†–æ–±–µ—Ä—Ç –ì–µ—Ä–º–∞–Ω–æ–≤–∏—á</option>
              <option value="vasilkovskiy.json">
                –í–∞—Å–∏–ª—å–∫–æ–≤—Å–∫–∏–π –°–µ—Ä–≥–µ–π –ò–≤–∞–Ω–æ–≤–∏—á
              </option>
              <option value="pereplyotchikov.json">
                –ü–µ—Ä–µ–ø–ª—ë—Ç—á–∏–∫–æ–≤ –í–∞—Å–∏–ª–∏–π –í–∞—Å–∏–ª—å–µ–≤–∏—á
              </option>
              <option value="saltanov.json">–°–∞–ª—Ç–∞–Ω–æ–≤ –°–µ—Ä–≥–µ–π –ù–∏–∫–æ–ª–∞–µ–≤–∏—á</option>
              <option value="sibirskiy.json">
                –°–∏–±–∏—Ä—Å–∫–∏–π –í–µ–Ω–∏–∞–º–∏–Ω –ú–∏—Ö–∞–π–ª–æ–≤–∏—á
              </option>
              <option value="solomatkin.json">
                –°–æ–ª–æ–º–∞—Ç–∫–∏–Ω –õ–µ–æ–Ω–∏–¥ –ò–≤–∞–Ω–æ–≤–∏—á
              </option>
              <option value="fyodorov.json">–§—ë–¥–æ—Ä–æ–≤ –°–µ–º—ë–Ω –§—ë–¥–æ—Ä–æ–≤–∏—á</option>
            </select>
            <label class="file-input-label" for="fileInput">
              üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å JSON
            </label>
            <input type="file" id="fileInput" accept=".json" />
          </div>
        </div>
        <div class="control-group">
          <label>&nbsp;</label>
          <button onclick="loadSelectedArtist()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        </div>
      </div>

      <div id="mainContent" class="hidden">
        <div class="currency-panel">
          <div class="control-group" id="currencyRatesGroup">
            <label class="label-with-info">
              –ê–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å ‚ÇΩ
              <button
                class="info-btn"
                onclick="showCurrencyInfo()"
                title="–°–ø—Ä–∞–≤–∫–∞"
              >
                ?
              </button>
            </label>
            <div class="rate-inputs" id="rateInputsContainer">
              <!-- –ü–æ–ª—è –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
          </div>
          <div class="control-group">
            <label>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ü–µ–Ω—ã –≤ —Ä—É–±–ª—è—Ö</label>
            <select id="priceMode">
              <option value="both">
                –ê–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å + –∫—É—Ä—Å –Ω–∞ –¥–∞—Ç—É –∞—É–∫—Ü–∏–æ–Ω–∞
              </option>
              <option value="current">–¢–æ–ª—å–∫–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å</option>
              <option value="historical">–¢–æ–ª—å–∫–æ –∫—É—Ä—Å –Ω–∞ –¥–∞—Ç—É –∞—É–∫—Ü–∏–æ–Ω–∞</option>
              <option value="original">–¢–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞</option>
            </select>
          </div>
          <div class="control-group">
            <label>&nbsp;</label>
            <button onclick="updateRates()">–û–±–Ω–æ–≤–∏—Ç—å –∫—É—Ä—Å—ã</button>
          </div>
          <div class="control-group">
            <label>&nbsp;</label>
            <button
              onclick="showHistoricalRates()"
              style="
                background: transparent;
                border: 1px solid #ffd700;
                color: #ffd700;
              "
            >
              üìÖ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∫—É—Ä—Å—ã
            </button>
          </div>
        </div>

        <div class="controls">
          <div class="control-group">
            <label>–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é</label>
            <input
              type="text"
              id="searchTitle"
              placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ..."
            />
          </div>
          <div class="control-group">
            <label>–§–∏–ª—å—Ç—Ä –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º</label>
            <div class="input-pair">
              <input type="number" id="minWidth" placeholder="–ú–∏–Ω. —à–∏—Ä–∏–Ω–∞" />
              <input type="number" id="maxWidth" placeholder="–ú–∞–∫—Å. —à–∏—Ä–∏–Ω–∞" />
            </div>
          </div>
          <div class="control-group">
            <label>&nbsp;</label>
            <div class="input-pair">
              <input type="number" id="minHeight" placeholder="–ú–∏–Ω. –≤—ã—Å–æ—Ç–∞" />
              <input type="number" id="maxHeight" placeholder="–ú–∞–∫—Å. –≤—ã—Å–æ—Ç–∞" />
            </div>
          </div>
          <div class="control-group">
            <label>–§–∏–ª—å—Ç—Ä –ø–æ –ø–ª–æ—â–∞–¥–∏ (—Å–º¬≤)</label>
            <div class="input-pair">
              <input type="number" id="minArea" placeholder="–ú–∏–Ω. –ø–ª–æ—â–∞–¥—å" />
              <input type="number" id="maxArea" placeholder="–ú–∞–∫—Å. –ø–ª–æ—â–∞–¥—å" />
            </div>
          </div>
          <div class="control-group">
            <label>–î–∞—Ç–∞ –∞—É–∫—Ü–∏–æ–Ω–∞</label>
            <div class="input-pair">
              <input type="date" id="dateFrom" />
              <input type="date" id="dateTo" />
            </div>
          </div>
          <div class="control-group">
            <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
            <select id="sortBy">
              <option value="date-desc">–ü–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ)</option>
              <option value="date-asc">–ü–æ –¥–∞—Ç–µ (—Å—Ç–∞—Ä—ã–µ)</option>
              <option value="width-asc">–ü–æ —à–∏—Ä–∏–Ω–µ ‚Üë</option>
              <option value="width-desc">–ü–æ —à–∏—Ä–∏–Ω–µ ‚Üì</option>
              <option value="height-asc">–ü–æ –≤—ã—Å–æ—Ç–µ ‚Üë</option>
              <option value="height-desc">–ü–æ –≤—ã—Å–æ—Ç–µ ‚Üì</option>
              <option value="area-asc">–ü–æ –ø–ª–æ—â–∞–¥–∏ ‚Üë</option>
              <option value="area-desc">–ü–æ –ø–ª–æ—â–∞–¥–∏ ‚Üì</option>
              <option value="title-asc">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ê-–Ø</option>
              <option value="title-desc">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é –Ø-–ê</option>
            </select>
          </div>
          <div class="control-group">
            <label>–°—Ç–∞—Ç—É—Å –ø—Ä–æ–¥–∞–∂–∏</label>
            <select id="saleStatus">
              <option value="all">–í—Å–µ</option>
              <option value="sold">–¢–æ–ª—å–∫–æ –ø—Ä–æ–¥–∞–Ω–Ω—ã–µ</option>
              <option value="not-sold">–¢–æ–ª—å–∫–æ –Ω–µ –ø—Ä–æ–¥–∞–Ω–Ω—ã–µ</option>
            </select>
          </div>
          <div class="control-group">
            <label>&nbsp;</label>
            <button onclick="resetFilters()">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
          </div>
        </div>

        <div class="stats">
          <div class="stat-item">
            <div class="stat-value" id="totalWorks">0</div>
            <div class="stat-label">–í—Å–µ–≥–æ —Ä–∞–±–æ—Ç</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="filteredWorks">0</div>
            <div class="stat-label">–ü–æ–∫–∞–∑–∞–Ω–æ</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="soldWorks">0</div>
            <div class="stat-label">–ü—Ä–æ–¥–∞–Ω–æ</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="notSoldWorks">0</div>
            <div class="stat-label">–ù–µ –ø—Ä–æ–¥–∞–Ω–æ</div>
          </div>
        </div>

        <!-- Analytics & Calculator Panel -->
        <div class="analytics-panel" id="analyticsPanel">
          <div class="analytics-header" onclick="toggleAnalytics()">
            <h2>
              üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ü–µ–Ω—ã
              <button
                class="info-btn"
                onclick="event.stopPropagation(); showCalcInfo()"
                title="–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä"
              >
                ?
              </button>
            </h2>
            <button class="analytics-toggle" id="analyticsToggle">
              –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å ‚ñº
            </button>
          </div>

          <div class="analytics-content" id="analyticsContent">
            <div class="calculator-section">
              <div class="calc-input-group">
                <h3>üìê –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ü–µ–Ω–∏–≤–∞–µ–º–æ–π –∫–∞—Ä—Ç–∏–Ω—ã</h3>
                <div class="calc-row">
                  <label>–®–∏—Ä–∏–Ω–∞ (—Å–º):</label>
                  <input
                    type="number"
                    id="calcWidth"
                    placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 50"
                    min="1"
                    max="500"
                  />
                </div>
                <div class="calc-row">
                  <label>–í—ã—Å–æ—Ç–∞ (—Å–º):</label>
                  <input
                    type="number"
                    id="calcHeight"
                    placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 70"
                    min="1"
                    max="500"
                  />
                </div>
                <div class="calc-row">
                  <label>–î–æ–ø—É—Å–∫ –ø–ª–æ—â–∞–¥–∏:</label>
                  <select id="calcAreaTolerance">
                    <option value="0.2">¬±20% (—Å—Ç—Ä–æ–≥–∏–π)</option>
                    <option value="0.3" selected>¬±30% (—É–º–µ—Ä–µ–Ω–Ω—ã–π)</option>
                    <option value="0.5">¬±50% (—à–∏—Ä–æ–∫–∏–π)</option>
                    <option value="1.0">¬±100% (–æ—á–µ–Ω—å —à–∏—Ä–æ–∫–∏–π)</option>
                  </select>
                </div>
              </div>

              <div class="calc-input-group">
                <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—á—ë—Ç–∞</h3>
                <div class="calc-row">
                  <label>–ü–µ—Ä–∏–æ–¥ –¥–∞–Ω–Ω—ã—Ö:</label>
                  <select id="calcPeriod">
                    <option value="2014">–° 2014 –≥–æ–¥–∞ (–∞–∫—Ç—É–∞–ª—å–Ω—ã–π)</option>
                    <option value="all">–í—Å–µ –≥–æ–¥—ã</option>
                    <option value="2020">–° 2020 –≥–æ–¥–∞</option>
                  </select>
                </div>
                <div class="calc-row">
                  <label>–î–∏—Å–∫–æ–Ω—Ç –∑–∞—Ä—É–±–µ–∂–Ω—ã—Ö:</label>
                  <input
                    type="range"
                    id="calcForeignDiscount"
                    min="0.4"
                    max="1.0"
                    step="0.05"
                    value="0.6"
                  />
                  <span class="range-value" id="discountValue">0.60</span>
                </div>
                <div class="calc-row" style="font-size: 0.8em; color: #888">
                  <label></label>
                  <span>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç 0.60 = –¥–∏—Å–∫–æ–Ω—Ç 40% –∫ –∑–∞—Ä—É–±–µ–∂–Ω—ã–º —Ü–µ–Ω–∞–º</span>
                </div>
                <div class="calc-row">
                  <label>
                    <input
                      type="checkbox"
                      id="calcIncludeUnsold"
                      style="margin-right: 8px"
                    />
                    –£—á–∏—Ç—ã–≤–∞—Ç—å –Ω–µ–ø—Ä–æ–¥–∞–Ω–Ω—ã–µ
                  </label>
                </div>
                <div
                  class="calc-row calc-unsold-options"
                  id="unsoldOptions"
                  style="display: none"
                >
                  <label>–ö–æ—ç—Ñ—Ñ. —ç—Å—Ç–∏–º–µ–π—Ç–∞:</label>
                  <input
                    type="range"
                    id="calcEstimateDiscount"
                    min="0.5"
                    max="1.0"
                    step="0.05"
                    value="0.8"
                  />
                  <span class="range-value" id="estimateDiscountValue"
                    >0.80</span
                  >
                </div>
                <div
                  class="calc-row calc-unsold-options"
                  id="unsoldHint"
                  style="display: none; font-size: 0.8em; color: #888"
                >
                  <label></label>
                  <span
                    >–ö–æ—ç—Ñ—Ñ. 0.80 = —ç—Å—Ç–∏–º–µ–π—Ç √ó 0.8 (—Ä—ã–Ω–æ–∫ –æ—Ç–≤–µ—Ä–≥ —ç—Ç—É —Ü–µ–Ω—É)</span
                  >
                </div>
                <button class="calc-button" onclick="calculatePrice()">
                  üßÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ—Ü–µ–Ω–∫—É
                </button>
              </div>
            </div>

            <div class="results-section" id="calcResults" style="display: none">
              <h3>üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h3>

              <div class="analytics-stats" id="analyticsStats">
                <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
              </div>

              <div class="price-estimate" id="priceEstimate">
                <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
              </div>

              <h3>üîç –°–æ–ø–æ—Å—Ç–∞–≤–∏–º—ã–µ —Ä–∞–±–æ—Ç—ã</h3>
              <div class="comparable-works" id="comparableWorks">
                <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
              </div>

              <div class="warning-box">
                <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong> –î–∞–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –Ω–æ—Å–∏—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–π
                —Ö–∞—Ä–∞–∫—Ç–µ—Ä. –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—é–∂–µ—Ç–∞, –∫–∞—á–µ—Å—Ç–≤–∞
                –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è, –ø—Ä–æ–≤–µ–Ω–∞–Ω—Å–∞, —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–∞–±–æ—Ç—ã –∏ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—ä—é–Ω–∫—Ç—É—Ä—ã
                —Ä—ã–Ω–∫–∞.
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="artworks-grid" id="artworksGrid">
        <div class="welcome-state">
          <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
          <p>
            –í—ã–±–µ—Ä–∏—Ç–µ —Ö—É–¥–æ–∂–Ω–∏–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π JSON —Ñ–∞–π–ª.
          </p>
          <p>–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—ã,</p>
          <p>
            –∞ —Ç–∞–∫–∂–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ü–µ–Ω—ã –≤ —Ä—É–±–ª—è—Ö –ø–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º—É –∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–º—É
            –∫—É—Ä—Å—É.
          </p>
        </div>
      </div>

      <footer>
        <p>–î–∞–Ω–Ω—ã–µ: ARTinvestment.RU | –°–æ–∑–¥–∞–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∞—É–∫—Ü–∏–æ–Ω–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂</p>
      </footer>
    </div>

    <!-- Lightbox -->
    <div id="lightbox" class="lightbox">
      <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
      <span class="lightbox-nav lightbox-prev" onclick="navigateLightbox(-1)"
        >&#10094;</span
      >
      <div class="lightbox-content">
        <img id="lightbox-image" class="lightbox-image" src="" alt="" />
        <div id="lightbox-caption" class="lightbox-caption"></div>
      </div>
      <span class="lightbox-nav lightbox-next" onclick="navigateLightbox(1)"
        >&#10095;</span
      >
    </div>

    <!-- Calculator Info Modal -->
    <div id="calcInfoModal" class="info-modal" onclick="closeCalcInfo(event)">
      <div
        class="info-modal-content"
        onclick="event.stopPropagation()"
        style="max-width: 700px"
      >
        <button class="info-modal-close" onclick="closeCalcInfo()">
          &times;
        </button>
        <h3>üßÆ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ—Ü–µ–Ω–∫–∏</h3>

        <p>
          <strong>–¶–µ–ª—å:</strong> –ü–æ–ª—É—á–∏—Ç—å –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—É—é —Ä—ã–Ω–æ—á–Ω—É—é –æ—Ü–µ–Ω–∫—É
          –∫–∞—Ä—Ç–∏–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –∞—É–∫—Ü–∏–æ–Ω–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂ —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º—ã—Ö —Ä–∞–±–æ—Ç
          —Ö—É–¥–æ–∂–Ω–∏–∫–∞.
        </p>

        <h4>üìê –í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h4>
        <ul>
          <li>
            <strong>–†–∞–∑–º–µ—Ä –∫–∞—Ä—Ç–∏–Ω—ã (–®√ó–í)</strong> ‚Äî –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –ø–ª–æ—â–∞–¥–∏ –∏ –ø–æ–∏—Å–∫–∞
            –∞–Ω–∞–ª–æ–≥–æ–≤
          </li>
          <li>
            <strong>–î–æ–ø—É—Å–∫ –ø–ª–æ—â–∞–¥–∏</strong> ‚Äî –Ω–∞—Å–∫–æ–ª—å–∫–æ –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –∞–Ω–∞–ª–æ–≥–∏
            (¬±20%...¬±100%)
          </li>
          <li>
            <strong>–ü–µ—Ä–∏–æ–¥ –¥–∞–Ω–Ω—ã—Ö</strong> ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è ¬´–° 2014 –≥–æ–¥–∞¬ª
            (–∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Ä—ã–Ω–æ–∫ –ø–æ—Å–ª–µ –∫—Ä–∏–∑–∏—Å–∞)
          </li>
          <li>
            <strong>–î–∏—Å–∫–æ–Ω—Ç –∑–∞—Ä—É–±–µ–∂–Ω—ã—Ö —Ü–µ–Ω</strong> ‚Äî –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç 0.60 –æ–∑–Ω–∞—á–∞–µ—Ç
            —Å–∫–∏–¥–∫—É 40% –∫ —Ü–µ–Ω–∞–º Sotheby's, Christie's –∏ –¥—Ä.
          </li>
        </ul>

        <h4>‚öôÔ∏è –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á—ë—Ç–∞</h4>
        <ol>
          <li>
            <strong>–ü–æ–∏—Å–∫ –∞–Ω–∞–ª–æ–≥–æ–≤:</strong> –û—Ç–±–∏—Ä–∞—é—Ç—Å—è —Ä–∞–±–æ—Ç—ã —Å –ø–ª–æ—â–∞–¥—å—é –≤
            –ø—Ä–µ–¥–µ–ª–∞—Ö –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –¥–æ–ø—É—Å–∫–∞
          </li>
          <li>
            <strong>–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —Ä—É–±–ª–∏:</strong> –¶–µ–Ω—ã –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ
            —Å—Ä–µ–¥–Ω–µ–≥–æ–¥–æ–≤–æ–º—É –∫—É—Ä—Å—É –¶–ë –†–§ –Ω–∞ –≥–æ–¥ –ø—Ä–æ–¥–∞–∂–∏
          </li>
          <li>
            <strong>–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –∑–∞—Ä—É–±–µ–∂–Ω—ã—Ö:</strong> –ö —Ü–µ–Ω–∞–º —Å –∑–∞—Ä—É–±–µ–∂–Ω—ã—Ö
            –∞—É–∫—Ü–∏–æ–Ω–æ–≤ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø–æ–Ω–∏–∂–∞—é—â–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (–¥–∏—Å–∫–æ–Ω—Ç —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ
            —Ä—ã–Ω–∫–∞)
          </li>
          <li>
            <strong>–†–∞—Å—á—ë—Ç –¥–∏–∞–ø–∞–∑–æ–Ω–∞:</strong>
            <ul>
              <li>–ù–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ ‚Äî 25-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å (Q1) —Ü–µ–Ω –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç</li>
              <li>–í–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ ‚Äî 75-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å (Q3)</li>
              <li>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: —Ä–∞—Å—á—ë—Ç –ø–æ –º–µ–¥–∏–∞–Ω–Ω–æ–π —Ü–µ–Ω–µ –∑–∞ —Å–º¬≤</li>
            </ul>
          </li>
        </ol>

        <h4>üìä –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h4>
        <ul>
          <li>
            <strong>–ü—Ä–æ–¥–∞–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</strong> ‚Äî —Ä–µ–∞–ª—å–Ω—ã–π —Å–ø—Ä–æ—Å, –æ—Å–Ω–æ–≤–∞ –¥–ª—è
            –æ—Ü–µ–Ω–∫–∏
          </li>
          <li>
            <strong>–ù–µ–ø—Ä–æ–¥–∞–Ω–Ω—ã–µ (—ç—Å—Ç–∏–º–µ–π—Ç)</strong> ‚Äî ¬´–ø–æ—Ç–æ–ª–æ–∫ —Ü–µ–Ω—ã¬ª, –∫–æ—Ç–æ—Ä—ã–π
            —Ä—ã–Ω–æ–∫ –æ—Ç–≤–µ—Ä–≥. –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∏–∂–Ω—é—é –≥—Ä–∞–Ω–∏—Ü—É —ç—Å—Ç–∏–º–µ–π—Ç–∞ –∫–∞–∫ –æ—Ä–∏–µ–Ω—Ç–∏—Ä
          </li>
          <li><strong>üá∑üá∫ / üåç</strong> ‚Äî —Ä–æ—Å—Å–∏–π—Å–∫–∏–π –∏–ª–∏ –∑–∞—Ä—É–±–µ–∂–Ω—ã–π –∞—É–∫—Ü–∏–æ–Ω</li>
          <li>
            <strong>–¶–µ–Ω–∞ –∑–∞ —Å–º¬≤</strong> ‚Äî –ø–æ–º–æ–≥–∞–µ—Ç —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Ä–∞–±–æ—Ç—ã —Ä–∞–∑–Ω—ã—Ö
            —Ä–∞–∑–º–µ—Ä–æ–≤
          </li>
        </ul>

        <h4>‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è</h4>
        <p>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä <strong>–Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç</strong>:</p>
        <ul>
          <li>–°—é–∂–µ—Ç –∏ –∂–∞–Ω—Ä (–ø–µ–π–∑–∞–∂ vs –ø–æ—Ä—Ç—Ä–µ—Ç)</li>
          <li>–ö–∞—á–µ—Å—Ç–≤–æ –∏ —É—Ä–æ–≤–µ–Ω—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è</li>
          <li>–ü—Ä–æ–≤–µ–Ω–∞–Ω—Å (–∏—Å—Ç–æ—Ä–∏—è –≤–ª–∞–¥–µ–Ω–∏—è)</li>
          <li>–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞–±–æ—Ç—ã</li>
          <li>–†–µ–¥–∫–æ—Å—Ç—å –ø–µ—Ä–∏–æ–¥–∞ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞</li>
        </ul>
        <p style="margin-top: 10px; color: #ff9800">
          <strong
            >–§–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Ç—Ä–µ–±—É–µ—Ç —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ ¬´–∑–¥—Ä–∞–≤–æ–≥–æ
            —Å–º—ã—Å–ª–∞¬ª.</strong
          >
        </p>
      </div>
    </div>

    <!-- Currency Info Modal -->
    <div
      id="currencyInfoModal"
      class="info-modal"
      onclick="closeCurrencyInfo(event)"
    >
      <div class="info-modal-content" onclick="event.stopPropagation()">
        <button class="info-modal-close" onclick="closeCurrencyInfo()">
          &times;
        </button>
        <h3>üí± –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç</h3>
        <p>–≠—Ç–∞ —Å–µ–∫—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—ã –∞—É–∫—Ü–∏–æ–Ω–æ–≤ –≤ —Ä—É–±–ª–∏.</p>

        <p>
          <strong>–ê–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å</strong> ‚Äî —Ç–µ–∫—É—â–∏–µ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç –∫ —Ä—É–±–ª—é. –í—ã
          –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∏—Ö –≤—Ä—É—á–Ω—É—é –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞.
        </p>

        <p>
          <strong>–ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ –≤–∞–ª—é—Ç—ã</strong>, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤
          —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Ö—É–¥–æ–∂–Ω–∏–∫–∞.
        </p>

        <p><strong>–†–µ–∂–∏–º—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ü–µ–Ω:</strong></p>
        <ul>
          <li>
            <strong>–ê–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å + –∫—É—Ä—Å –Ω–∞ –¥–∞—Ç—É –∞—É–∫—Ü–∏–æ–Ω–∞</strong> ‚Äî
            –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
          </li>
          <li>
            <strong>–¢–æ–ª—å–∫–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å</strong> ‚Äî –ø–µ—Ä–µ—Å—á—ë—Ç –ø–æ —Ç–µ–∫—É—â–µ–º—É –∫—É—Ä—Å—É
            (–¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å–µ–≥–æ–¥–Ω—è)
          </li>
          <li>
            <strong>–¢–æ–ª—å–∫–æ –∫—É—Ä—Å –Ω–∞ –¥–∞—Ç—É –∞—É–∫—Ü–∏–æ–Ω–∞</strong> ‚Äî –ø–µ—Ä–µ—Å—á—ë—Ç –ø–æ
            –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–º—É –∫—É—Ä—Å—É –¶–ë –†–§ –Ω–∞ –¥–∞—Ç—É –ø—Ä–æ–¥–∞–∂–∏
          </li>
          <li>
            <strong>–¢–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞</strong> ‚Äî –±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏,
            –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—É—é –≤–∞–ª—é—Ç—É –∞—É–∫—Ü–∏–æ–Ω–∞
          </li>
        </ul>

        <p>
          <strong>–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∫—É—Ä—Å—ã</strong> (2007‚Äì2025) –±–µ—Ä—É—Ç—Å—è –∏–∑
          —Å—Ä–µ–¥–Ω–µ–≥–æ–¥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¶–ë –†–§.
        </p>

        <p>
          –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤ –Ω–∞–∂–º–∏—Ç–µ <strong>¬´–û–±–Ω–æ–≤–∏—Ç—å –∫—É—Ä—Å—ã¬ª</strong> –¥–ª—è
          –ø–µ—Ä–µ—Å—á—ë—Ç–∞.
        </p>
      </div>
    </div>

    <!-- Historical Rates Modal -->
    <div
      id="historicalRatesModal"
      class="info-modal"
      onclick="closeHistoricalRates(event)"
    >
      <div
        class="info-modal-content"
        onclick="event.stopPropagation()"
        style="max-width: 800px"
      >
        <button class="info-modal-close" onclick="closeHistoricalRates()">
          &times;
        </button>
        <h3>üìÖ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∫—É—Ä—Å—ã –¶–ë –†–§</h3>
        <p>
          –°—Ä–µ–¥–Ω–µ–≥–æ–¥–æ–≤—ã–µ –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç –∫ —Ä—É–±–ª—é, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ü–µ–Ω –Ω–∞
          –¥–∞—Ç—É –∞—É–∫—Ü–∏–æ–Ω–∞:
        </p>
        <div class="rates-table-container">
          <table class="rates-table" id="ratesTable">
            <thead>
              <tr>
                <th>–ì–æ–¥</th>
                <th>USD</th>
                <th>EUR</th>
                <th>GBP</th>
                <th>CHF</th>
                <th>SEK</th>
                <th>DKK</th>
              </tr>
            </thead>
            <tbody id="ratesTableBody">
              <!-- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </tbody>
          </table>
        </div>
        <p class="rates-source">
          –ò—Å—Ç–æ—á–Ω–∏–∫: –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ä–µ–¥–Ω–µ–≥–æ–¥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
          –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫–∞ –†–§. –î–ª—è —Ç–æ—á–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
          –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å
          <a
            href="https://www.cbr.ru/currency_base/dynamics/"
            target="_blank"
            style="color: #ffd700"
            >cbr.ru</a
          >
        </p>
      </div>
    </div>

    <script>
      let artworksData = [];
      let currentArtistFolder = "";
      let lightboxImages = [];
      let currentLightboxIndex = 0;

      let currentRates = {
        USD: 88,
        EUR: 95,
        GBP: 112,
        CHF: 100,
        SEK: 8,
        DKK: 13,
        RUR: 1,
        RUB: 1,
      };

      const historicalRates = {
        2007: {
          USD: 25.6,
          EUR: 34.7,
          GBP: 51.1,
          CHF: 21.2,
          SEK: 3.7,
          DKK: 4.6,
        },
        2008: {
          USD: 24.9,
          EUR: 36.4,
          GBP: 46.0,
          CHF: 23.1,
          SEK: 3.9,
          DKK: 4.9,
        },
        2009: {
          USD: 31.8,
          EUR: 44.1,
          GBP: 49.6,
          CHF: 29.5,
          SEK: 4.3,
          DKK: 5.9,
        },
        2010: {
          USD: 30.4,
          EUR: 40.3,
          GBP: 47.1,
          CHF: 29.3,
          SEK: 4.4,
          DKK: 5.4,
        },
        2011: {
          USD: 29.4,
          EUR: 40.9,
          GBP: 47.1,
          CHF: 33.3,
          SEK: 4.5,
          DKK: 5.5,
        },
        2012: {
          USD: 31.1,
          EUR: 39.9,
          GBP: 49.3,
          CHF: 33.2,
          SEK: 4.6,
          DKK: 5.4,
        },
        2013: {
          USD: 31.8,
          EUR: 42.3,
          GBP: 49.5,
          CHF: 34.7,
          SEK: 4.9,
          DKK: 5.7,
        },
        2014: {
          USD: 38.6,
          EUR: 51.0,
          GBP: 62.0,
          CHF: 40.8,
          SEK: 5.4,
          DKK: 6.8,
        },
        2015: {
          USD: 61.0,
          EUR: 68.0,
          GBP: 92.0,
          CHF: 63.0,
          SEK: 7.2,
          DKK: 9.1,
        },
        2016: {
          USD: 67.0,
          EUR: 74.0,
          GBP: 87.0,
          CHF: 68.0,
          SEK: 7.7,
          DKK: 9.9,
        },
        2017: {
          USD: 58.3,
          EUR: 65.9,
          GBP: 75.3,
          CHF: 59.7,
          SEK: 6.9,
          DKK: 8.9,
        },
        2018: {
          USD: 62.7,
          EUR: 74.0,
          GBP: 83.8,
          CHF: 63.9,
          SEK: 7.1,
          DKK: 9.9,
        },
        2019: {
          USD: 64.7,
          EUR: 72.5,
          GBP: 82.9,
          CHF: 65.1,
          SEK: 6.8,
          DKK: 9.7,
        },
        2020: {
          USD: 72.1,
          EUR: 84.3,
          GBP: 93.6,
          CHF: 79.2,
          SEK: 8.2,
          DKK: 11.3,
        },
        2021: {
          USD: 73.7,
          EUR: 87.2,
          GBP: 101.0,
          CHF: 80.7,
          SEK: 8.5,
          DKK: 11.7,
        },
        2022: {
          USD: 68.5,
          EUR: 72.3,
          GBP: 83.5,
          CHF: 71.5,
          SEK: 6.6,
          DKK: 9.7,
        },
        2023: {
          USD: 89.7,
          EUR: 97.9,
          GBP: 111.9,
          CHF: 101.2,
          SEK: 8.4,
          DKK: 13.1,
        },
        2024: {
          USD: 92.0,
          EUR: 100.0,
          GBP: 116.0,
          CHF: 104.0,
          SEK: 8.5,
          DKK: 13.4,
        },
        2025: {
          USD: 88.0,
          EUR: 95.0,
          GBP: 112.0,
          CHF: 100.0,
          SEK: 8.0,
          DKK: 13.0,
        },
      };

      function loadSelectedArtist() {
        const select = document.getElementById("artistSelect");
        const fileInput = document.getElementById("fileInput");

        if (fileInput.files.length > 0) {
          loadFromFile(fileInput.files[0]);
        } else if (select.value) {
          loadFromUrl(select.value);
        } else {
          alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ö—É–¥–æ–∂–Ω–∏–∫–∞ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª");
        }
      }

      async function loadFromUrl(url) {
        try {
          showLoading();
          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–∞–ø–∫—É —Ö—É–¥–æ–∂–Ω–∏–∫–∞ –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
          currentArtistFolder = url.replace(".json", "");
          const response = await fetch(url);
          if (!response.ok) throw new Error("–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω");
          const data = await response.json();
          processData(data);
        } catch (error) {
          console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", error);
          showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: " + error.message);
        }
      }

      function loadFromFile(file) {
        const reader = new FileReader();
        currentArtistFolder = file.name.replace(".json", "").toLowerCase();
        reader.onload = function (e) {
          try {
            const data = JSON.parse(e.target.result);
            processData(data);
          } catch (error) {
            showError("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è JSON —Ñ–∞–π–ª–∞: " + error.message);
          }
        };
        reader.readAsText(file);
      }

      function processData(data) {
        document.getElementById("artistName").textContent =
          data.artist || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ö—É–¥–æ–∂–Ω–∏–∫";
        document.getElementById("dataSource").textContent =
          data.data_source || "";
        document.getElementById("mainContent").classList.remove("hidden");

        artworksData = (data.artworks || []).map((artwork, index) => ({
          ...artwork,
          index,
          parsedDimensions: parseDimensions(artwork.dimensions_cm),
          lastSaleDate: parseDate(
            artwork.latest_sale_details?.date ||
              (artwork.sales_history && artwork.sales_history.length > 0
                ? artwork.sales_history[0].date
                : null)
          ),
        }));

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–Ω–µ–ª—å –≤–∞–ª—é—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
        const usedCurrencies = getUsedCurrencies(data.artworks || []);
        updateCurrencyPanel(usedCurrencies);

        updateDisplay();
      }

      function showLoading() {
        document.getElementById("artworksGrid").innerHTML = `
          <div class="loading">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
          </div>
        `;
      }

      function showError(message) {
        document.getElementById("artworksGrid").innerHTML = `
          <div class="empty-state">
            <p>${message}</p>
          </div>
        `;
      }

      function parseDimensions(dimStr) {
        if (!dimStr) return { width: null, height: null, area: null };

        const cleaned = dimStr.replace(/,/g, ".").replace(/\s/g, "");
        const match = cleaned.match(/(\d+(?:\.\d+)?)[—Öx–•X√ó](\d+(?:\.\d+)?)/);

        if (match) {
          const height = parseFloat(match[1]);
          const width = parseFloat(match[2]);
          return { height, width, area: height * width };
        }

        return { width: null, height: null, area: null };
      }

      function parseDate(dateStr) {
        if (!dateStr) return null;
        const parts = dateStr.split(".");
        if (parts.length === 3) {
          return new Date(parts[2], parts[1] - 1, parts[0]);
        }
        return null;
      }

      function getYearFromDate(dateStr) {
        if (!dateStr) return null;
        const parts = dateStr.split(".");
        if (parts.length === 3) {
          return parseInt(parts[2]);
        }
        return null;
      }

      function isSold(artwork) {
        const salePrice = artwork.latest_sale_details?.sale_price || "";
        const lower = salePrice.toLowerCase();
        return (
          salePrice &&
          !lower.includes("–Ω–µ –ø—Ä–æ–¥–∞–Ω") &&
          !lower.includes("–Ω–µ—Ç") &&
          !lower.includes("–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞") &&
          salePrice.match(/[\d\s]+\s*(USD|EUR|GBP|CHF|RUR|RUB)/i)
        );
      }

      function parsePriceValue(priceStr) {
        if (!priceStr) return null;
        const cleaned = priceStr.replace(/\s/g, "").replace(/,/g, ".");
        const match = cleaned.match(/([\d.]+)\s*(USD|EUR|GBP|CHF|RUR|RUB)/i);
        if (match) {
          return {
            amount: parseFloat(match[1]),
            currency: match[2].toUpperCase(),
          };
        }
        return null;
      }

      function convertToRub(priceData, rates) {
        if (!priceData) return null;
        const rate = rates[priceData.currency] || 1;
        return priceData.amount * rate;
      }

      function formatRub(amount) {
        if (amount === null) return "";
        return new Intl.NumberFormat("ru-RU", {
          style: "currency",
          currency: "RUB",
          maximumFractionDigits: 0,
        }).format(amount);
      }

      function getHistoricalRate(year, currency) {
        if (!year || !currency) return null;
        const yearRates = historicalRates[year];
        if (yearRates && yearRates[currency]) {
          return yearRates[currency];
        }
        const years = Object.keys(historicalRates)
          .map(Number)
          .sort((a, b) => a - b);
        const closest = years.reduce((prev, curr) =>
          Math.abs(curr - year) < Math.abs(prev - year) ? curr : prev
        );
        return historicalRates[closest]?.[currency] || null;
      }

      function filterAndSort() {
        const searchTitle = document
          .getElementById("searchTitle")
          .value.toLowerCase();
        const minWidth =
          parseFloat(document.getElementById("minWidth").value) || 0;
        const maxWidth =
          parseFloat(document.getElementById("maxWidth").value) || Infinity;
        const minHeight =
          parseFloat(document.getElementById("minHeight").value) || 0;
        const maxHeight =
          parseFloat(document.getElementById("maxHeight").value) || Infinity;
        const minArea =
          parseFloat(document.getElementById("minArea").value) || 0;
        const maxArea =
          parseFloat(document.getElementById("maxArea").value) || Infinity;
        const dateFrom = document.getElementById("dateFrom").value
          ? new Date(document.getElementById("dateFrom").value)
          : null;
        const dateTo = document.getElementById("dateTo").value
          ? new Date(document.getElementById("dateTo").value)
          : null;
        const sortBy = document.getElementById("sortBy").value;
        const saleStatus = document.getElementById("saleStatus").value;

        let filtered = artworksData.filter((artwork) => {
          if (
            searchTitle &&
            !artwork.title.toLowerCase().includes(searchTitle)
          ) {
            return false;
          }

          const dim = artwork.parsedDimensions;
          if (dim.width !== null) {
            if (dim.width < minWidth || dim.width > maxWidth) return false;
          }
          if (dim.height !== null) {
            if (dim.height < minHeight || dim.height > maxHeight) return false;
          }
          if (dim.area !== null) {
            if (dim.area < minArea || dim.area > maxArea) return false;
          }

          if (
            dateFrom &&
            artwork.lastSaleDate &&
            artwork.lastSaleDate < dateFrom
          ) {
            return false;
          }
          if (dateTo && artwork.lastSaleDate && artwork.lastSaleDate > dateTo) {
            return false;
          }

          if (saleStatus === "sold" && !isSold(artwork)) return false;
          if (saleStatus === "not-sold" && isSold(artwork)) return false;

          return true;
        });

        filtered.sort((a, b) => {
          switch (sortBy) {
            case "date-desc":
              return (b.lastSaleDate || 0) - (a.lastSaleDate || 0);
            case "date-asc":
              return (a.lastSaleDate || 0) - (b.lastSaleDate || 0);
            case "width-asc":
              return (
                (a.parsedDimensions.width || 0) -
                (b.parsedDimensions.width || 0)
              );
            case "width-desc":
              return (
                (b.parsedDimensions.width || 0) -
                (a.parsedDimensions.width || 0)
              );
            case "height-asc":
              return (
                (a.parsedDimensions.height || 0) -
                (b.parsedDimensions.height || 0)
              );
            case "height-desc":
              return (
                (b.parsedDimensions.height || 0) -
                (a.parsedDimensions.height || 0)
              );
            case "area-asc":
              return (
                (a.parsedDimensions.area || 0) - (b.parsedDimensions.area || 0)
              );
            case "area-desc":
              return (
                (b.parsedDimensions.area || 0) - (a.parsedDimensions.area || 0)
              );
            case "title-asc":
              return a.title.localeCompare(b.title, "ru");
            case "title-desc":
              return b.title.localeCompare(a.title, "ru");
            default:
              return 0;
          }
        });

        return filtered;
      }

      function updateDisplay() {
        const filtered = filterAndSort();

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        document.getElementById("totalWorks").textContent = artworksData.length;
        document.getElementById("filteredWorks").textContent = filtered.length;
        document.getElementById("soldWorks").textContent =
          filtered.filter(isSold).length;
        document.getElementById("notSoldWorks").textContent = filtered.filter(
          (a) => !isSold(a)
        ).length;

        // –°–æ–±–∏—Ä–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è lightbox
        lightboxImages = filtered
          .filter((a) => a.image)
          .map((a) => ({
            src: `images/${currentArtistFolder}/${a.image}`,
            title: a.title,
          }));

        const grid = document.getElementById("artworksGrid");

        if (filtered.length === 0) {
          grid.innerHTML =
            '<div class="empty-state"><p>–ù–µ—Ç —Ä–∞–±–æ—Ç, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∏–ª—å—Ç—Ä–∞–º</p></div>';
          return;
        }

        const priceMode = document.getElementById("priceMode").value;

        grid.innerHTML = filtered
          .map((artwork, displayIndex) => {
            const dim = artwork.parsedDimensions;
            const sale = artwork.latest_sale_details || {};
            const soldStatus = isSold(artwork);
            const salePrice = parsePriceValue(sale.sale_price);
            const year = getYearFromDate(sale.date);

            let priceRubCurrent = "";
            let priceRubHistorical = "";

            if (
              salePrice &&
              (priceMode === "both" || priceMode === "current")
            ) {
              const rubCurrent = convertToRub(salePrice, currentRates);
              if (rubCurrent) {
                priceRubCurrent = `<span class="price-rub">(${formatRub(
                  rubCurrent
                )} –ø–æ —Ç–µ–∫—É—â–µ–º—É –∫—É—Ä—Å—É)</span>`;
              }
            }

            if (
              salePrice &&
              year &&
              (priceMode === "both" || priceMode === "historical")
            ) {
              const histRate = getHistoricalRate(year, salePrice.currency);
              if (histRate) {
                const rubHist = salePrice.amount * histRate;
                priceRubHistorical = `<span class="price-rub-historical">(${formatRub(
                  rubHist
                )} –ø–æ –∫—É—Ä—Å—É ${year}–≥.)</span>`;
              }
            }

            // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            let imageHtml = "";
            if (artwork.image) {
              const imageSrc = `images/${currentArtistFolder}/${artwork.image}`;
              const imgIndex = lightboxImages.findIndex(
                (img) => img.src === imageSrc
              );
              imageHtml = `
                <div class="artwork-image-container">
                  <img class="artwork-image" 
                       src="${imageSrc}" 
                       alt="${artwork.title}"
                       onclick="openLightbox(${imgIndex})"
                       onerror="this.parentElement.innerHTML='<div class=\\'artwork-image-placeholder\\'>üñºÔ∏è</div>'" />
                </div>
              `;
            } else {
              imageHtml = `
                <div class="artwork-image-container">
                  <div class="artwork-image-placeholder">üñºÔ∏è</div>
                </div>
              `;
            }

            return `
              <div class="artwork-card">
                ${imageHtml}
                <div class="artwork-content">
                  <div class="artwork-header">
                    <h3 class="artwork-title">${artwork.title}</h3>
                    ${
                      artwork.creation_year
                        ? `<span class="artwork-year">${artwork.creation_year}</span>`
                        : ""
                    }
                  </div>
                  
                  <div class="artwork-details">
                    ${
                      dim.width
                        ? `
                      <div class="detail-item">
                        <div class="detail-label">–†–∞–∑–º–µ—Ä—ã</div>
                        <div class="detail-value">
                          <span class="dimensions-badge">${dim.height} √ó ${
                            dim.width
                          } —Å–º</span>
                          ${
                            dim.area
                              ? `<span class="area-badge">${Math.round(
                                  dim.area
                                )} —Å–º¬≤</span>`
                              : ""
                          }
                        </div>
                      </div>
                    `
                        : ""
                    }
                    ${
                      artwork.technique
                        ? `
                      <div class="detail-item">
                        <div class="detail-label">–¢–µ—Ö–Ω–∏–∫–∞</div>
                        <div class="detail-value">${artwork.technique}</div>
                      </div>
                    `
                        : ""
                    }
                    ${
                      sale.auction_house
                        ? `
                      <div class="detail-item">
                        <div class="detail-label">–ê—É–∫—Ü–∏–æ–Ω</div>
                        <div class="detail-value">${sale.auction_house}</div>
                      </div>
                    `
                        : ""
                    }
                    ${
                      sale.date
                        ? `
                      <div class="detail-item">
                        <div class="detail-label">–î–∞—Ç–∞</div>
                        <div class="detail-value">${sale.date}</div>
                      </div>
                    `
                        : ""
                    }
                  </div>
                  
                  <div class="price-display">
                    ${
                      sale.estimate
                        ? `
                      <div class="price-row">
                        <span class="price-label">–≠—Å—Ç–∏–º–µ–π—Ç:</span>
                        <span class="price-value">${sale.estimate}</span>
                      </div>
                    `
                        : ""
                    }
                    <div class="price-row">
                      <span class="price-label">–†–µ–∑—É–ª—å—Ç–∞—Ç:</span>
                      <span class="price-value ${
                        soldStatus ? "sold" : "not-sold"
                      }">
                        ${sale.sale_price || "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"}
                      </span>
                    </div>
                    ${
                      priceRubCurrent || priceRubHistorical
                        ? `
                      <div class="price-row">
                        <span class="price-label">–í —Ä—É–±–ª—è—Ö:</span>
                        <span class="price-value">
                          ${priceRubCurrent}
                          ${priceRubHistorical}
                        </span>
                      </div>
                    `
                        : ""
                    }
                  </div>
                  
                  ${
                    artwork.sales_history && artwork.sales_history.length > 0
                      ? `
                    <div class="sales-history">
                      <button class="history-toggle" onclick="toggleHistory(this)">
                        <span>–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–∞–∂ (${
                          artwork.sales_history.length
                        })</span>
                        <span>‚ñº</span>
                      </button>
                      <div class="history-content">
                        ${artwork.sales_history
                          .map(
                            (sale) => `
                          <div class="history-item">
                            <div class="history-date">${
                              sale.date || "–ù–µ—Ç –¥–∞—Ç—ã"
                            }</div>
                            <div class="history-auction">${
                              sale.auction_house || ""
                            }</div>
                            <div class="history-prices">
                              ${
                                sale.estimate
                                  ? `<span>–≠—Å—Ç–∏–º–µ–π—Ç: ${sale.estimate}</span>`
                                  : ""
                              }
                              ${
                                sale.result
                                  ? `<span>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${sale.result}</span>`
                                  : ""
                              }
                            </div>
                          </div>
                        `
                          )
                          .join("")}
                      </div>
                    </div>
                  `
                      : ""
                  }
                </div>
              </div>
            `;
          })
          .join("");
      }

      function toggleHistory(btn) {
        const content = btn.nextElementSibling;
        content.classList.toggle("show");
        btn.querySelector("span:last-child").textContent =
          content.classList.contains("show") ? "‚ñ≤" : "‚ñº";
      }

      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–∏–µ –≤–∞–ª—é—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
      function getUsedCurrencies(artworks) {
        const currencies = new Set();
        const currencyRegex =
          /\b(USD|EUR|GBP|CHF|SEK|DKK|NOK|PLN|CZK|HUF|AUD|CAD|JPY|CNY)\b/gi;

        artworks.forEach((artwork) => {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–µ–Ω—É –ø—Ä–æ–¥–∞–∂–∏
          const salePrice = artwork.latest_sale_details?.sale_price || "";
          const saleMatches = salePrice.match(currencyRegex);
          if (saleMatches)
            saleMatches.forEach((c) => currencies.add(c.toUpperCase()));

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç—Å—Ç–∏–º–µ–π—Ç
          const estimate = artwork.latest_sale_details?.estimate || "";
          const estMatches = estimate.match(currencyRegex);
          if (estMatches)
            estMatches.forEach((c) => currencies.add(c.toUpperCase()));

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ–¥–∞–∂
          if (artwork.sales_history) {
            artwork.sales_history.forEach((sale) => {
              const histPrice = sale.sale_price || "";
              const histMatches = histPrice.match(currencyRegex);
              if (histMatches)
                histMatches.forEach((c) => currencies.add(c.toUpperCase()));
            });
          }
        });

        return Array.from(currencies).sort();
      }

      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞ –∫—É—Ä—Å–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤–∞–ª—é—Ç
      function updateCurrencyPanel(currencies) {
        const container = document.getElementById("rateInputsContainer");
        const panelGroup = document.getElementById("currencyRatesGroup");

        if (currencies.length === 0) {
          panelGroup.style.display = "none";
          return;
        }

        panelGroup.style.display = "";
        container.innerHTML = currencies
          .map((currency) => {
            const defaultRate = currentRates[currency] || 1;
            return `
            <div class="rate-input-group">
              <span class="rate-label">${currency}</span>
              <input type="number" id="rate${currency}" value="${defaultRate}" step="0.01" />
            </div>
          `;
          })
          .join("");
      }

      function updateRates() {
        // –ß–∏—Ç–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª–µ–π
        const inputs = document.querySelectorAll(
          '#rateInputsContainer input[type="number"]'
        );
        inputs.forEach((input) => {
          const currency = input.id.replace("rate", "");
          currentRates[currency] =
            parseFloat(input.value) || currentRates[currency] || 1;
        });
        updateDisplay();
      }

      function resetFilters() {
        document.getElementById("searchTitle").value = "";
        document.getElementById("minWidth").value = "";
        document.getElementById("maxWidth").value = "";
        document.getElementById("minHeight").value = "";
        document.getElementById("maxHeight").value = "";
        document.getElementById("minArea").value = "";
        document.getElementById("maxArea").value = "";
        document.getElementById("dateFrom").value = "";
        document.getElementById("dateTo").value = "";
        document.getElementById("sortBy").value = "date-desc";
        document.getElementById("saleStatus").value = "all";
        updateDisplay();
      }

      // Lightbox —Ñ—É–Ω–∫—Ü–∏–∏
      function openLightbox(index) {
        if (index < 0 || index >= lightboxImages.length) return;
        currentLightboxIndex = index;
        const img = lightboxImages[index];
        document.getElementById("lightbox-image").src = img.src;
        document.getElementById("lightbox-caption").textContent = img.title;
        document.getElementById("lightbox").classList.add("active");
        document.body.style.overflow = "hidden";
      }

      function closeLightbox() {
        document.getElementById("lightbox").classList.remove("active");
        document.body.style.overflow = "";
      }

      // Calculator info modal functions
      function showCalcInfo() {
        document.getElementById("calcInfoModal").classList.add("active");
        document.body.style.overflow = "hidden";
      }

      function closeCalcInfo(event) {
        if (event && event.target !== event.currentTarget) return;
        document.getElementById("calcInfoModal").classList.remove("active");
        document.body.style.overflow = "";
      }

      // Currency info modal functions
      function showCurrencyInfo() {
        document.getElementById("currencyInfoModal").classList.add("active");
        document.body.style.overflow = "hidden";
      }

      function closeCurrencyInfo(event) {
        if (event && event.target !== event.currentTarget) return;
        document.getElementById("currencyInfoModal").classList.remove("active");
        document.body.style.overflow = "";
      }

      // Historical rates modal functions
      function showHistoricalRates() {
        const tbody = document.getElementById("ratesTableBody");
        const years = Object.keys(historicalRates).sort((a, b) => b - a);

        tbody.innerHTML = years
          .map((year) => {
            const rates = historicalRates[year];
            return `
            <tr>
              <td>${year}</td>
              <td>${rates.USD?.toFixed(2) || "‚Äî"}</td>
              <td>${rates.EUR?.toFixed(2) || "‚Äî"}</td>
              <td>${rates.GBP?.toFixed(2) || "‚Äî"}</td>
              <td>${rates.CHF?.toFixed(2) || "‚Äî"}</td>
              <td>${rates.SEK?.toFixed(2) || "‚Äî"}</td>
              <td>${rates.DKK?.toFixed(2) || "‚Äî"}</td>
            </tr>
          `;
          })
          .join("");

        document.getElementById("historicalRatesModal").classList.add("active");
        document.body.style.overflow = "hidden";
      }

      function closeHistoricalRates(event) {
        if (event && event.target !== event.currentTarget) return;
        document
          .getElementById("historicalRatesModal")
          .classList.remove("active");
        document.body.style.overflow = "";
      }

      function navigateLightbox(direction) {
        currentLightboxIndex += direction;
        if (currentLightboxIndex < 0)
          currentLightboxIndex = lightboxImages.length - 1;
        if (currentLightboxIndex >= lightboxImages.length)
          currentLightboxIndex = 0;
        const img = lightboxImages[currentLightboxIndex];
        document.getElementById("lightbox-image").src = img.src;
        document.getElementById("lightbox-caption").textContent = img.title;
      }

      // –ó–∞–∫—Ä—ã—Ç–∏–µ lightbox –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
      document
        .getElementById("lightbox")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeLightbox();
          }
        });

      // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è lightbox
      document.addEventListener("keydown", function (e) {
        if (!document.getElementById("lightbox").classList.contains("active"))
          return;
        if (e.key === "Escape") closeLightbox();
        if (e.key === "ArrowLeft") navigateLightbox(-1);
        if (e.key === "ArrowRight") navigateLightbox(1);
      });

      // –ó–∞–∫—Ä—ã—Ç–∏–µ info modal –ø–æ Escape
      document.addEventListener("keydown", function (e) {
        if (
          document
            .getElementById("currencyInfoModal")
            .classList.contains("active")
        ) {
          if (e.key === "Escape") closeCurrencyInfo();
        }
        if (
          document
            .getElementById("historicalRatesModal")
            .classList.contains("active")
        ) {
          if (e.key === "Escape") closeHistoricalRates();
        }
        if (
          document.getElementById("calcInfoModal").classList.contains("active")
        ) {
          if (e.key === "Escape") closeCalcInfo();
        }
      });

      // ===== ANALYTICS & CALCULATOR =====

      // –°–ø–∏—Å–æ–∫ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∑–∞—Ä—É–±–µ–∂–Ω—ã—Ö –∞—É–∫—Ü–∏–æ–Ω–Ω—ã—Ö –¥–æ–º–æ–≤
      const foreignAuctionHouses = [
        "sotheby",
        "christie",
        "bonhams",
        "macdougall",
        "phillips",
        "dorotheum",
        "bruun",
        "bukowskis",
        "artcurial",
        "millon",
        "aguttes",
        "drouot",
        "koller",
        "lempertz",
        "ketterer",
        "grisebach",
        "hampel",
        "nagel",
        "neumeister",
        "van ham",
        "bloomsbury",
        "lyon",
        "bader",
        "zofingen",
        "piasa",
      ];

      function isForeignAuction(auctionHouse) {
        if (!auctionHouse) return false;
        const lower = auctionHouse.toLowerCase();
        return (
          foreignAuctionHouses.some((name) => lower.includes(name)) ||
          lower.includes("london") ||
          lower.includes("new york") ||
          lower.includes("paris") ||
          lower.includes("geneva") ||
          lower.includes("zurich") ||
          lower.includes("munich") ||
          lower.includes("vienna") ||
          lower.includes("stockholm")
        );
      }

      function toggleAnalytics() {
        const content = document.getElementById("analyticsContent");
        const toggle = document.getElementById("analyticsToggle");
        if (content.classList.contains("expanded")) {
          content.classList.remove("expanded");
          toggle.textContent = "–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å ‚ñº";
        } else {
          content.classList.add("expanded");
          toggle.textContent = "–°–≤–µ—Ä–Ω—É—Ç—å ‚ñ≤";
        }
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–ª–∑—É–Ω–∫–∞ –¥–∏—Å–∫–æ–Ω—Ç–∞
      document
        .getElementById("calcForeignDiscount")
        .addEventListener("input", function () {
          document.getElementById("discountValue").textContent = parseFloat(
            this.value
          ).toFixed(2);
        });

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–ª–∑—É–Ω–∫–∞ —ç—Å—Ç–∏–º–µ–π—Ç–∞
      document
        .getElementById("calcEstimateDiscount")
        .addEventListener("input", function () {
          document.getElementById("estimateDiscountValue").textContent =
            parseFloat(this.value).toFixed(2);
        });

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —á–µ–∫–±–æ–∫—Å–∞ –Ω–µ–ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö
      document
        .getElementById("calcIncludeUnsold")
        .addEventListener("change", function () {
          const show = this.checked;
          document.getElementById("unsoldOptions").style.display = show
            ? "flex"
            : "none";
          document.getElementById("unsoldHint").style.display = show
            ? "flex"
            : "none";
        });

      function calculatePrice() {
        const width = parseFloat(document.getElementById("calcWidth").value);
        const height = parseFloat(document.getElementById("calcHeight").value);
        const tolerance = parseFloat(
          document.getElementById("calcAreaTolerance").value
        );
        const period = document.getElementById("calcPeriod").value;
        const foreignDiscount = parseFloat(
          document.getElementById("calcForeignDiscount").value
        );
        const includeUnsold =
          document.getElementById("calcIncludeUnsold").checked;
        const estimateDiscount = parseFloat(
          document.getElementById("calcEstimateDiscount").value
        );

        if (!width || !height) {
          alert("–í–≤–µ–¥–∏—Ç–µ —à–∏—Ä–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É –∫–∞—Ä—Ç–∏–Ω—ã");
          return;
        }

        const targetArea = width * height;
        const minArea = targetArea * (1 - tolerance);
        const maxArea = targetArea * (1 + tolerance);

        // –§–∏–ª—å—Ç—Ä—É–µ–º —Ä–∞–±–æ—Ç—ã –ø–æ –ø–ª–æ—â–∞–¥–∏ –∏ –ø–µ—Ä–∏–æ–¥—É
        let comparable = artworksData.filter((artwork) => {
          const dim = artwork.parsedDimensions;
          if (!dim.area) return false;
          if (dim.area < minArea || dim.area > maxArea) return false;

          // –§–∏–ª—å—Ç—Ä –ø–æ –ø–µ—Ä–∏–æ–¥—É
          if (period !== "all") {
            const year = getYearFromDate(artwork.latest_sale_details?.date);
            if (!year || year < parseInt(period)) return false;
          }

          return true;
        });

        // –†–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ –ø—Ä–æ–¥–∞–Ω–Ω—ã–µ –∏ –Ω–µ–ø—Ä–æ–¥–∞–Ω–Ω—ã–µ
        const soldWorks = comparable.filter(isSold);
        const unsoldWorks = comparable.filter((a) => !isSold(a));

        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ü–µ–Ω—ã –≤ —Ä—É–±–ª—è—Ö —Å —É—á—ë—Ç–æ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤
        const pricesWithDetails = soldWorks
          .map((artwork) => {
            const sale = artwork.latest_sale_details || {};
            const priceData = parsePriceValue(sale.sale_price);
            if (!priceData) return null;

            const year = getYearFromDate(sale.date);
            const histRate = year
              ? getHistoricalRate(year, priceData.currency)
              : null;
            const rate = histRate || currentRates[priceData.currency] || 1;
            let priceRub = priceData.amount * rate;

            const isForeign = isForeignAuction(sale.auction_house);
            if (isForeign) {
              priceRub *= foreignDiscount;
            }

            return {
              artwork,
              priceRub,
              originalPrice: `${priceData.amount.toLocaleString("ru-RU")} ${
                priceData.currency
              }`,
              isForeign,
              year,
              area: artwork.parsedDimensions.area,
              // –î–∞–Ω–Ω—ã–µ –¥–ª—è —Ñ–æ—Ä–º—É–ª—ã
              formulaData: isForeign
                ? {
                    amount: priceData.amount,
                    currency: priceData.currency,
                    rate: rate,
                    discount: foreignDiscount,
                    priceBeforeDiscount: priceData.amount * rate,
                  }
                : null,
            };
          })
          .filter(Boolean);

        // –≠—Å—Ç–∏–º–µ–π—Ç—ã –Ω–µ–ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö (–∫–∞–∫ –ø–æ—Ç–æ–ª–æ–∫)
        const unsoldEstimates = unsoldWorks
          .map((artwork) => {
            const sale = artwork.latest_sale_details || {};
            const estStr = sale.estimate || "";
            // –ë–µ—Ä—ë–º –Ω–∏–∂–Ω—é—é –≥—Ä–∞–Ω–∏—Ü—É —ç—Å—Ç–∏–º–µ–π—Ç–∞
            const match = estStr.match(
              /([\d\s,.]+)\s*[-‚Äì]\s*[\d\s,.]+\s*(USD|EUR|GBP|CHF|RUR|RUB)/i
            );
            if (!match) return null;

            const amount = parseFloat(
              match[1].replace(/[\s,]/g, "").replace(",", ".")
            );
            const currency = match[2].toUpperCase();
            const year = getYearFromDate(sale.date);
            const histRate = year ? getHistoricalRate(year, currency) : null;
            const rate = histRate || currentRates[currency] || 1;
            let priceRub = amount * rate;

            const isForeign = isForeignAuction(sale.auction_house);
            if (isForeign) {
              priceRub *= foreignDiscount;
            }

            // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —ç—Å—Ç–∏–º–µ–π—Ç–∞ (—Ä—ã–Ω–æ–∫ –æ—Ç–≤–µ—Ä–≥ —ç—Ç—É —Ü–µ–Ω—É)
            const priceBeforeEstDiscount = priceRub;
            priceRub *= estimateDiscount;

            return {
              artwork,
              priceRub,
              originalPrice: `${amount.toLocaleString(
                "ru-RU"
              )} ${currency} (—ç—Å—Ç–∏–º–µ–π—Ç)`,
              isForeign,
              year,
              area: artwork.parsedDimensions.area,
              isEstimate: true,
              estimateDiscount: estimateDiscount,
              // –î–∞–Ω–Ω—ã–µ –¥–ª—è —Ñ–æ—Ä–º—É–ª—ã
              formulaData: {
                amount: amount,
                currency: currency,
                rate: rate,
                foreignDiscount: isForeign ? foreignDiscount : 1,
                estimateDiscount: estimateDiscount,
                priceBeforeDiscount: amount * rate,
                priceBeforeEstDiscount: priceBeforeEstDiscount,
              },
            };
          })
          .filter(Boolean);

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        displayCalculatorResults({
          targetArea,
          tolerance,
          period,
          foreignDiscount,
          soldWorks: pricesWithDetails,
          unsoldEstimates,
          totalComparable: comparable.length,
          includeUnsold,
          estimateDiscount,
        });
      }

      function displayCalculatorResults(data) {
        const resultsDiv = document.getElementById("calcResults");
        resultsDiv.style.display = "block";

        const {
          soldWorks,
          unsoldEstimates,
          targetArea,
          period,
          foreignDiscount,
          totalComparable,
          includeUnsold,
          estimateDiscount,
        } = data;

        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        const statsDiv = document.getElementById("analyticsStats");
        const foreignCount = soldWorks.filter((w) => w.isForeign).length;
        const russianCount = soldWorks.length - foreignCount;

        // –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã –Ω–µ–ø—Ä–æ–¥–∞–Ω–Ω—ã–µ
        const worksForCalc = includeUnsold
          ? [...soldWorks, ...unsoldEstimates]
          : soldWorks;

        // –†–∞—Å—á—ë—Ç –º–µ–¥–∏–∞–Ω—ã –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ
        const prices = worksForCalc
          .map((w) => w.priceRub)
          .sort((a, b) => a - b);
        const median =
          prices.length > 0
            ? prices.length % 2 === 0
              ? (prices[prices.length / 2 - 1] + prices[prices.length / 2]) / 2
              : prices[Math.floor(prices.length / 2)]
            : 0;
        const avg =
          prices.length > 0
            ? prices.reduce((a, b) => a + b, 0) / prices.length
            : 0;
        const minPrice = prices.length > 0 ? Math.min(...prices) : 0;
        const maxPrice = prices.length > 0 ? Math.max(...prices) : 0;

        // –¶–µ–Ω–∞ –∑–∞ —Å–º¬≤ (–º–µ–¥–∏–∞–Ω–Ω–∞—è)
        const pricePerSqCm =
          worksForCalc.length > 0
            ? worksForCalc.map((w) => w.priceRub / w.area).sort((a, b) => a - b)
            : [];
        const medianPerSqCm =
          pricePerSqCm.length > 0
            ? pricePerSqCm.length % 2 === 0
              ? (pricePerSqCm[pricePerSqCm.length / 2 - 1] +
                  pricePerSqCm[pricePerSqCm.length / 2]) /
                2
              : pricePerSqCm[Math.floor(pricePerSqCm.length / 2)]
            : 0;

        statsDiv.innerHTML = `
          <div class="analytics-stat">
            <div class="analytics-stat-value">${totalComparable}</div>
            <div class="analytics-stat-label">–°–æ–ø–æ—Å—Ç–∞–≤–∏–º—ã—Ö —Ä–∞–±–æ—Ç</div>
          </div>
          <div class="analytics-stat">
            <div class="analytics-stat-value">${soldWorks.length}</div>
            <div class="analytics-stat-label">–ü—Ä–æ–¥–∞–Ω–Ω—ã—Ö</div>
          </div>
          <div class="analytics-stat">
            <div class="analytics-stat-value ${
              unsoldEstimates.length > soldWorks.length ? "warning" : ""
            }">${unsoldEstimates.length}${includeUnsold ? " ‚úì" : ""}</div>
            <div class="analytics-stat-label">–ù–µ –ø—Ä–æ–¥–∞–Ω–æ${
              includeUnsold ? " (√ó" + estimateDiscount + ")" : ""
            }</div>
          </div>
          <div class="analytics-stat">
            <div class="analytics-stat-value">${russianCount} / ${foreignCount}</div>
            <div class="analytics-stat-label">–†–§ / –ó–∞—Ä—É–±–µ–∂</div>
          </div>
          <div class="analytics-stat">
            <div class="analytics-stat-value">${
              medianPerSqCm > 0
                ? Math.round(medianPerSqCm).toLocaleString("ru-RU")
                : "‚Äî"
            }</div>
            <div class="analytics-stat-label">‚ÇΩ –∑–∞ —Å–º¬≤ (–º–µ–¥–∏–∞–Ω–∞)</div>
          </div>
        `;

        // –û—Ü–µ–Ω–∫–∞
        const estimateDiv = document.getElementById("priceEstimate");
        if (worksForCalc.length === 0) {
          estimateDiv.innerHTML = `
            <div class="price-estimate-label">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö</div>
            <div class="price-estimate-value" style="color: #888;">–ù–µ—Ç —Ä–∞–±–æ—Ç –≤ —ç—Ç–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ</div>
            <div class="price-estimate-note">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–æ–ø—É—Å–∫ –ø–ª–æ—â–∞–¥–∏ –∏–ª–∏ –ø–µ—Ä–∏–æ–¥${
              !includeUnsold ? ", –∏–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ –Ω–µ–ø—Ä–æ–¥–∞–Ω–Ω—ã–µ" : ""
            }</div>
          `;
        } else {
          // –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω: –æ—Ç Q1 –¥–æ Q3 (–∏–ª–∏ min-max –µ—Å–ª–∏ –º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö)
          let lowEstimate, highEstimate;
          if (prices.length >= 4) {
            const q1Idx = Math.floor(prices.length * 0.25);
            const q3Idx = Math.floor(prices.length * 0.75);
            lowEstimate = prices[q1Idx];
            highEstimate = prices[q3Idx];
          } else {
            lowEstimate = minPrice;
            highEstimate = maxPrice;
          }

          // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: —Ä–∞—Å—á—ë—Ç –ø–æ —Ü–µ–Ω–µ –∑–∞ —Å–º¬≤
          const estimateByArea = medianPerSqCm * targetArea;

          estimateDiv.innerHTML = `
            <div class="price-estimate-label">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω (–ø–æ –∞–Ω–∞–ª–æ–≥–∞–º)</div>
            <div class="price-estimate-value">
              ${formatRub(lowEstimate)} ‚Äî ${formatRub(highEstimate)}
            </div>
            <div class="price-estimate-note">
              –ú–µ–¥–∏–∞–Ω–∞: ${formatRub(median)} | 
              –ü–æ –ø–ª–æ—â–∞–¥–∏ (${Math.round(targetArea)} —Å–º¬≤ √ó ${Math.round(
            medianPerSqCm
          )} ‚ÇΩ): ${formatRub(estimateByArea)}
            </div>
            <div class="price-estimate-note">
              ${period !== "all" ? `–î–∞–Ω–Ω—ã–µ —Å ${period} –≥–æ–¥–∞` : "–í—Å–µ –≥–æ–¥—ã"}
              ${foreignCount > 0 ? `, –∑–∞—Ä—É–±–µ–∂–Ω—ã–µ √ó${foreignDiscount}` : ""}
              ${includeUnsold ? `, –Ω–µ–ø—Ä–æ–¥–∞–Ω–Ω—ã–µ √ó${estimateDiscount}` : ""}
            </div>
          `;
        }

        // –°–ø–∏—Å–æ–∫ —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º—ã—Ö —Ä–∞–±–æ—Ç
        const worksDiv = document.getElementById("comparableWorks");
        const allWorks = [...soldWorks, ...unsoldEstimates].sort(
          (a, b) => b.priceRub - a.priceRub
        );

        if (allWorks.length === 0) {
          worksDiv.innerHTML =
            '<div class="no-results-calc">–ù–µ—Ç —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º—ã—Ö —Ä–∞–±–æ—Ç</div>';
        } else {
          worksDiv.innerHTML = allWorks
            .slice(0, 15)
            .map((item) => {
              const dim = item.artwork.parsedDimensions;
              const sale = item.artwork.latest_sale_details || {};
              return `
              <div class="comparable-work">
                <div class="comparable-work-info">
                  <div class="comparable-work-title">${item.artwork.title}</div>
                  <div class="comparable-work-details">
                    ${dim.height}√ó${dim.width} —Å–º (${Math.round(
                dim.area
              )} —Å–º¬≤) | 
                    ${sale.auction_house || "?"} | ${item.year || "?"}
                    ${item.isForeign ? " üåç" : " üá∑üá∫"}
                    ${
                      item.isEstimate
                        ? ' <span style="color:#ff9800">(–Ω–µ –ø—Ä–æ–¥–∞–Ω–æ)</span>'
                        : ""
                    }
                  </div>
                </div>
                <div class="comparable-work-price">
                  <div class="comparable-work-price-value ${
                    item.isForeign ? "foreign" : ""
                  }${item.isEstimate ? " estimate" : ""}" 
                       ${
                         item.formulaData
                           ? `title="${item.isEstimate 
                               ? `–§–æ—Ä–º—É–ª–∞: ${item.formulaData.amount.toLocaleString("ru-RU")} ${item.formulaData.currency} √ó ${item.formulaData.rate.toFixed(2)} ‚ÇΩ${item.formulaData.foreignDiscount < 1 ? ' √ó ' + item.formulaData.foreignDiscount + ' (–∑–∞—Ä—É–±.)' : ''} √ó ${item.formulaData.estimateDiscount} (—ç—Å—Ç.) = ${formatRub(item.priceRub)}\n(—ç—Å—Ç–∏–º–µ–π—Ç –¥–æ –∫–æ—ç—Ñ—Ñ.: ${formatRub(item.formulaData.priceBeforeEstDiscount)})`
                               : `–§–æ—Ä–º—É–ª–∞: ${item.formulaData.amount.toLocaleString("ru-RU")} ${item.formulaData.currency} √ó ${item.formulaData.rate.toFixed(2)} ‚ÇΩ √ó ${item.formulaData.discount} = ${formatRub(item.priceRub)}\n(–¥–æ –¥–∏—Å–∫–æ–Ω—Ç–∞: ${formatRub(item.formulaData.priceBeforeDiscount)})`
                             }"`
                           : ""
                       }>
                    ${formatRub(item.priceRub)}
                  </div>
                  <div class="comparable-work-price-original">${
                    item.originalPrice
                  }</div>
                </div>
              </div>
            `;
            })
            .join("");

          if (allWorks.length > 15) {
            worksDiv.innerHTML += `<div style="text-align:center; padding:10px; color:#888;">... –∏ –µ—â—ë ${
              allWorks.length - 15
            } —Ä–∞–±–æ—Ç</div>`;
          }
        }
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
      document
        .getElementById("searchTitle")
        .addEventListener("input", updateDisplay);
      document
        .getElementById("minWidth")
        .addEventListener("input", updateDisplay);
      document
        .getElementById("maxWidth")
        .addEventListener("input", updateDisplay);
      document
        .getElementById("minHeight")
        .addEventListener("input", updateDisplay);
      document
        .getElementById("maxHeight")
        .addEventListener("input", updateDisplay);
      document
        .getElementById("minArea")
        .addEventListener("input", updateDisplay);
      document
        .getElementById("maxArea")
        .addEventListener("input", updateDisplay);
      document
        .getElementById("dateFrom")
        .addEventListener("change", updateDisplay);
      document
        .getElementById("dateTo")
        .addEventListener("change", updateDisplay);
      document
        .getElementById("sortBy")
        .addEventListener("change", updateDisplay);
      document
        .getElementById("saleStatus")
        .addEventListener("change", updateDisplay);
      document
        .getElementById("priceMode")
        .addEventListener("change", updateDisplay);
      document
        .getElementById("artistSelect")
        .addEventListener("change", function () {
          document.getElementById("fileInput").value = "";
        });
      document
        .getElementById("fileInput")
        .addEventListener("change", function () {
          if (this.files.length > 0) {
            document.getElementById("artistSelect").value = "";
          }
        });
    </script>
  </body>
</html>
